<!DOCTYPE html>
<html lang="zh">
<head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="utf-8">
<title>《Android Framework 之路》Android5.1 MediaScanner - onlyloveyd</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">



    <meta name="description" content="前言 MediaScanner是Android系统中针对媒体文件的扫描过程，将储存空间中的媒体文件通过扫描的方式遍历并存储在数据库中，然后通过MediaProvider提供接口使用，在Android多媒体中占有很重要的位置。">
<meta name="keywords" content="Framework">
<meta property="og:type" content="article">
<meta property="og:title" content="《Android Framework 之路》Android5.1 MediaScanner">
<meta property="og:url" content="https://onlyloveyd.cn/2015/10/07/《Android Framework 之路》Android5.1 MediaScanner/index.html">
<meta property="og:site_name" content="onlyloveyd">
<meta property="og:description" content="前言 MediaScanner是Android系统中针对媒体文件的扫描过程，将储存空间中的媒体文件通过扫描的方式遍历并存储在数据库中，然后通过MediaProvider提供接口使用，在Android多媒体中占有很重要的位置。">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://onlyloveyd.cn/images/og_image.png">
<meta property="og:updated_time" content="2019-06-16T00:10:47.754Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="《Android Framework 之路》Android5.1 MediaScanner">
<meta name="twitter:description" content="前言 MediaScanner是Android系统中针对媒体文件的扫描过程，将储存空间中的媒体文件通过扫描的方式遍历并存储在数据库中，然后通过MediaProvider提供接口使用，在Android多媒体中占有很重要的位置。">
<meta name="twitter:image" content="https://onlyloveyd.cn/images/og_image.png">







<link rel="icon" href="/images/favicon.svg">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.7.2/css/bulma.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,600|Source+Code+Pro">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-dark.css">


    
    
    
    <style>body>.footer,body>.navbar,body>.section{opacity:0}</style>
    

    
    
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css">
    

    
    

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css">


    
    
    
    

<link rel="stylesheet" href="/css/back-to-top.css">


    
    

    
    
    
    

    
    
<link rel="stylesheet" href="/css/progressbar.css">
<script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>

    
    
    

    
    
    


<link rel="stylesheet" href="/css/style.css">
</head>
<body class="is-3-column">
    <nav class="navbar navbar-main">
    <div class="container">
        <div class="navbar-brand is-flex-center">
            <a class="navbar-item navbar-logo" href="/">
            
                <img src="/images/logo.svg" alt="《Android Framework 之路》Android5.1 MediaScanner" height="28">
            
            </a>
        </div>
        <div class="navbar-menu">
            
            <div class="navbar-start">
                
                <a class="navbar-item" href="/">Home</a>
                
                <a class="navbar-item" href="/archives">Archives</a>
                
                <a class="navbar-item" href="/categories">Categories</a>
                
                <a class="navbar-item" href="/tags">Tags</a>
                
                <a class="navbar-item" href="/about">About</a>
                
            </div>
            
            <div class="navbar-end">
                
                    
                    
                    <a class="navbar-item" target="_blank" title="Download on GitHub" href="https://github.com/onlyloveyd">
                        
                        <i class="fab fa-github"></i>
                        
                    </a>
                    
                
                
                
                <a class="navbar-item search" title="搜索" href="javascript:;">
                    <i class="fas fa-search"></i>
                </a>
                
            </div>
        </div>
    </div>
</nav>
    
    <section class="section">
        <div class="container">
            <div class="columns">
                <div class="column is-8-tablet is-8-desktop is-6-widescreen has-order-2 column-main"><div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2015-10-07T11:46:01.000Z">2015-10-07</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/Android源码/">Android源码</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    29 分钟 读完 (大约 4319 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                《Android Framework 之路》Android5.1 MediaScanner
            
        </h1>
        <div class="content">
            <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p> MediaScanner是Android系统中针对媒体文件的扫描过程，将储存空间中的媒体文件通过扫描的方式遍历并存储在数据库中，然后通过MediaProvider提供接口使用，在Android多媒体中占有很重要的位置。</p>
<a id="more"></a>

<h2 id="源码位置"><a href="#源码位置" class="headerlink" title="源码位置"></a>源码位置</h2><p> packages\providers\mediaprovider<br> frameworks\base\media\java\android\media<br> frameworks\av\media\libmedia<br> frameworks\base\media\jni<br> frameworks\av\media\libstagefright</p>
<h2 id="扫描过程"><a href="#扫描过程" class="headerlink" title="扫描过程"></a>扫描过程</h2><p> MediaScannerReceiver.java (packages\providers\mediaprovider\src\com\android\providers\media)<br> MediaScannerReceiver继承BroadcastReceiver,在AndroidManifest.xml静态注册</p>
<figure class="highlight xml hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">receiver</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"MediaScannerReceiver"</span>&gt;</span></span><br><span class="line">     <span class="hljs-tag">&lt;<span class="hljs-name">intent-filter</span>&gt;</span></span><br><span class="line">         <span class="hljs-tag">&lt;<span class="hljs-name">action</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.intent.action.BOOT_COMPLETED"</span> /&gt;</span></span><br><span class="line">     <span class="hljs-tag">&lt;/<span class="hljs-name">intent-filter</span>&gt;</span></span><br><span class="line">     <span class="hljs-tag">&lt;<span class="hljs-name">intent-filter</span>&gt;</span></span><br><span class="line">         <span class="hljs-tag">&lt;<span class="hljs-name">action</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.intent.action.MEDIA_MOUNTED"</span> /&gt;</span></span><br><span class="line">         <span class="hljs-tag">&lt;<span class="hljs-name">data</span> <span class="hljs-attr">android:scheme</span>=<span class="hljs-string">"file"</span> /&gt;</span></span><br><span class="line">     <span class="hljs-tag">&lt;/<span class="hljs-name">intent-filter</span>&gt;</span></span><br><span class="line">     <span class="hljs-tag">&lt;<span class="hljs-name">intent-filter</span>&gt;</span></span><br><span class="line">         <span class="hljs-tag">&lt;<span class="hljs-name">action</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.intent.action.MEDIA_UNMOUNTED"</span> /&gt;</span></span><br><span class="line">         <span class="hljs-tag">&lt;<span class="hljs-name">data</span> <span class="hljs-attr">android:scheme</span>=<span class="hljs-string">"file"</span> /&gt;</span></span><br><span class="line">     <span class="hljs-tag">&lt;/<span class="hljs-name">intent-filter</span>&gt;</span></span><br><span class="line">     <span class="hljs-tag">&lt;<span class="hljs-name">intent-filter</span>&gt;</span></span><br><span class="line">         <span class="hljs-tag">&lt;<span class="hljs-name">action</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.intent.action.MEDIA_SCANNER_SCAN_FILE"</span> /&gt;</span></span><br><span class="line">         <span class="hljs-tag">&lt;<span class="hljs-name">data</span> <span class="hljs-attr">android:scheme</span>=<span class="hljs-string">"file"</span> /&gt;</span></span><br><span class="line">     <span class="hljs-tag">&lt;/<span class="hljs-name">intent-filter</span>&gt;</span></span><br><span class="line"> <span class="hljs-tag">&lt;/<span class="hljs-name">receiver</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p> 可以看到，当接收到<br>  android.intent.action.BOOT_COMPLETED<br>  android.intent.action.MEDIA_MOUNTED<br>  android.intent.action.MEDIA_UNMOUNTED<br>  android.intent.action.MEDIA_SCANNER_SCAN_FILE<br>广播的时候，MediaScannerReceiver中的onReceiver()方法将会执行  </p>
<figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onReceive</span><span class="hljs-params">(Context context, Intent intent)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">final</span> String action = intent.getAction();</span><br><span class="line">        <span class="hljs-keyword">final</span> Uri uri = intent.getData();</span><br><span class="line">        <span class="hljs-keyword">if</span> (Intent.ACTION_BOOT_COMPLETED.equals(action)) &#123;</span><br><span class="line">            <span class="hljs-comment">// Scan both internal and external storage</span></span><br><span class="line">            scan(context, MediaProvider.INTERNAL_VOLUME);</span><br><span class="line">            scan(context, MediaProvider.EXTERNAL_VOLUME);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">            <span class="hljs-keyword">if</span> (uri.getScheme().equals(<span class="hljs-string">"file"</span>)) &#123;</span><br><span class="line">                <span class="hljs-comment">// handle intents related to external storage</span></span><br><span class="line">                String path = uri.getPath();</span><br><span class="line">                String externalStoragePath = Environment.getExternalStorageDirectory().getPath();</span><br><span class="line">                String legacyPath = Environment.getLegacyExternalStorageDirectory().getPath();</span><br><span class="line"></span><br><span class="line">                <span class="hljs-keyword">try</span> &#123;</span><br><span class="line">                    path = <span class="hljs-keyword">new</span> File(path).getCanonicalPath();</span><br><span class="line">                &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    Log.e(TAG, <span class="hljs-string">"couldn't canonicalize "</span> + path);</span><br><span class="line">                    <span class="hljs-keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="hljs-keyword">if</span> (path.startsWith(legacyPath)) &#123;</span><br><span class="line">                    path = externalStoragePath + path.substring(legacyPath.length());</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                Log.d(TAG, <span class="hljs-string">"action: "</span> + action + <span class="hljs-string">" path: "</span> + path);</span><br><span class="line">                <span class="hljs-keyword">if</span> (Intent.ACTION_MEDIA_MOUNTED.equals(action)) &#123;</span><br><span class="line">                    <span class="hljs-comment">// scan whenever any volume is mounted</span></span><br><span class="line">                    scan(context, MediaProvider.EXTERNAL_VOLUME);</span><br><span class="line">                &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (Intent.ACTION_MEDIA_SCANNER_SCAN_FILE.equals(action) &amp;&amp;</span><br><span class="line">                        path != <span class="hljs-keyword">null</span> &amp;&amp; path.startsWith(externalStoragePath + <span class="hljs-string">"/"</span>)) &#123;</span><br><span class="line">                    scanFile(context, path);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p> onReceiver方法中，会执行到scan()或者是scanFile()方法，一个是针对整个卷，一个是针对具体的文件，从传入的参数可以看出眉目，scan传入的是卷名，scanFile传入的是文件路径。通过接收广播启动扫描，然而不管是scan还是scanFile都是以startService的方式启动MediaScannerService。</p>
<figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">scan</span><span class="hljs-params">(Context context, String volume)</span> </span>&#123;</span><br><span class="line">    Bundle args = <span class="hljs-keyword">new</span> Bundle();</span><br><span class="line">    args.putString(<span class="hljs-string">"volume"</span>, volume);</span><br><span class="line">    context.startService(</span><br><span class="line">            <span class="hljs-keyword">new</span> Intent(context, MediaScannerService.class).putExtras(args));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">scanFile</span><span class="hljs-params">(Context context, String path)</span> </span>&#123;</span><br><span class="line">    Bundle args = <span class="hljs-keyword">new</span> Bundle();</span><br><span class="line">    args.putString(<span class="hljs-string">"filepath"</span>, path);</span><br><span class="line">    context.startService(</span><br><span class="line">            <span class="hljs-keyword">new</span> Intent(context, MediaScannerService.class).putExtras(args));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> 分别传入卷名或者文件路径。<br> MediaScannerService.java (packages\providers\mediaprovider\src\com\android\providers\media)<br> MediaScannerService看下AndroidManifest.xml文件中定义</p>
<figure class="highlight xml hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">service</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"MediaScannerService"</span> <span class="hljs-attr">android:exported</span>=<span class="hljs-string">"true"</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">action</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.media.IMediaScannerService"</span> /&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;/<span class="hljs-name">intent-filter</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">service</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p> 继承Service，实现Runnable接口，首先执行onCreate()方法</p>
<figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onCreate</span><span class="hljs-params">()</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">    PowerManager pm = (PowerManager)getSystemService(Context.POWER_SERVICE);</span><br><span class="line">    mWakeLock = pm.newWakeLock(PowerManager.PARTIAL_WAKE_LOCK, TAG);</span><br><span class="line">    StorageManager storageManager = (StorageManager)getSystemService(Context.STORAGE_SERVICE);</span><br><span class="line">    mExternalStoragePaths = storageManager.getVolumePaths();</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">// Start up the thread running the service.  Note that we create a</span></span><br><span class="line">    <span class="hljs-comment">// separate thread because the service normally runs in the process's</span></span><br><span class="line">    <span class="hljs-comment">// main thread, which we don't want to block.</span></span><br><span class="line">    Thread thr = <span class="hljs-keyword">new</span> Thread(<span class="hljs-keyword">null</span>, <span class="hljs-keyword">this</span>, <span class="hljs-string">"MediaScannerService"</span>);</span><br><span class="line">    thr.start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> 这里会单独启动一个线程来处理，然后走到onStartCommand()</p>
<figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">onStartCommand</span><span class="hljs-params">(Intent intent, <span class="hljs-keyword">int</span> flags, <span class="hljs-keyword">int</span> startId)</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">    <span class="hljs-keyword">while</span> (mServiceHandler == <span class="hljs-keyword">null</span>) &#123;</span><br><span class="line">        <span class="hljs-keyword">synchronized</span> (<span class="hljs-keyword">this</span>) &#123;</span><br><span class="line">            <span class="hljs-keyword">try</span> &#123;</span><br><span class="line">                wait(<span class="hljs-number">100</span>);</span><br><span class="line">            &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">if</span> (intent == <span class="hljs-keyword">null</span>) &#123;</span><br><span class="line">        Log.e(TAG, <span class="hljs-string">"Intent is null in onStartCommand: "</span>,</span><br><span class="line">            <span class="hljs-keyword">new</span> NullPointerException());</span><br><span class="line">        <span class="hljs-keyword">return</span> Service.START_NOT_STICKY;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Message msg = mServiceHandler.obtainMessage();</span><br><span class="line">    msg.arg1 = startId;</span><br><span class="line">    msg.obj = intent.getExtras();</span><br><span class="line">    mServiceHandler.sendMessage(msg);</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">// Try again later if we are killed before we can finish scanning.</span></span><br><span class="line">    <span class="hljs-keyword">return</span> Service.START_REDELIVER_INTENT;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> 这里先等待mServiceHandler创建完成，然后通过handler message机制传递消息给handler处理，这里的mServiceHandler创建过程是在run(）方法中</p>
<figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">    <span class="hljs-comment">// reduce priority below other background threads to avoid interfering</span></span><br><span class="line">    <span class="hljs-comment">// with other services at boot time.</span></span><br><span class="line">    Process.setThreadPriority(Process.THREAD_PRIORITY_BACKGROUND +</span><br><span class="line">            Process.THREAD_PRIORITY_LESS_FAVORABLE);</span><br><span class="line">    Looper.prepare();</span><br><span class="line"></span><br><span class="line">    mServiceLooper = Looper.myLooper();</span><br><span class="line">    mServiceHandler = <span class="hljs-keyword">new</span> ServiceHandler();</span><br><span class="line"></span><br><span class="line">    Looper.loop();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> 由于这个是单独的线程，无法保证在发送消息的时候，handler已经创建完成，所以需要等待handler的创建<br> 看下这个处理消息的handler</p>
<figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ServiceHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Handler</span></span></span><br><span class="line"><span class="hljs-class"></span>&#123;</span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">handleMessage</span><span class="hljs-params">(Message msg)</span></span></span><br><span class="line"><span class="hljs-function">    </span>&#123;</span><br><span class="line">        Bundle arguments = (Bundle) msg.obj;</span><br><span class="line">        String filePath = arguments.getString(<span class="hljs-string">"filepath"</span>);</span><br><span class="line">        <span class="hljs-keyword">try</span> &#123;</span><br><span class="line">            <span class="hljs-keyword">if</span> (filePath != <span class="hljs-keyword">null</span>) &#123;</span><br><span class="line">                IBinder binder = arguments.getIBinder(<span class="hljs-string">"listener"</span>);</span><br><span class="line">                IMediaScannerListener listener = </span><br><span class="line">                        (binder == <span class="hljs-keyword">null</span> ? <span class="hljs-keyword">null</span> : IMediaScannerListener.Stub.asInterface(binder));</span><br><span class="line">                Uri uri = <span class="hljs-keyword">null</span>;</span><br><span class="line">                <span class="hljs-keyword">try</span> &#123;</span><br><span class="line">                    uri = scanFile(filePath, arguments.getString(<span class="hljs-string">"mimetype"</span>));</span><br><span class="line">                &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    Log.e(TAG, <span class="hljs-string">"Exception scanning file"</span>, e);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="hljs-keyword">if</span> (listener != <span class="hljs-keyword">null</span>) &#123;</span><br><span class="line">                    listener.scanCompleted(filePath, uri);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">                String volume = arguments.getString(<span class="hljs-string">"volume"</span>);</span><br><span class="line">                String[] directories = <span class="hljs-keyword">null</span>;</span><br><span class="line">                <span class="hljs-keyword">if</span> (MediaProvider.INTERNAL_VOLUME.equals(volume)) &#123;</span><br><span class="line">                    <span class="hljs-comment">// scan internal media storage</span></span><br><span class="line">                    directories = <span class="hljs-keyword">new</span> String[] &#123;</span><br><span class="line">                            Environment.getRootDirectory() + <span class="hljs-string">"/media"</span>,</span><br><span class="line">                            Environment.getOemDirectory() + <span class="hljs-string">"/media"</span>,</span><br><span class="line">                    &#125;;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (MediaProvider.EXTERNAL_VOLUME.equals(volume)) &#123;</span><br><span class="line">                    <span class="hljs-comment">// scan external storage volumes</span></span><br><span class="line">                    directories = mExternalStoragePaths;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="hljs-keyword">if</span> (directories != <span class="hljs-keyword">null</span>) &#123;</span><br><span class="line">                    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">false</span>) Log.d(TAG, <span class="hljs-string">"start scanning volume "</span> + volume + <span class="hljs-string">": "</span></span><br><span class="line">                            + Arrays.toString(directories));</span><br><span class="line">                    scan(directories, volume);</span><br><span class="line">                    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">false</span>) Log.d(TAG, <span class="hljs-string">"done scanning volume "</span> + volume);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            Log.e(TAG, <span class="hljs-string">"Exception in handleMessage"</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        stopSelf(msg.arg1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p> 分别执行scan和scanFile方法</p>
<figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">scan</span><span class="hljs-params">(String[] directories, String volumeName)</span> </span>&#123;</span><br><span class="line">    Uri uri = Uri.parse(<span class="hljs-string">"file://"</span> + directories[<span class="hljs-number">0</span>]);</span><br><span class="line">    <span class="hljs-comment">// don't sleep while scanning</span></span><br><span class="line">    mWakeLock.acquire();</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">try</span> &#123;</span><br><span class="line">        ContentValues values = <span class="hljs-keyword">new</span> ContentValues();</span><br><span class="line">        values.put(MediaStore.MEDIA_SCANNER_VOLUME, volumeName);</span><br><span class="line">        Uri scanUri = getContentResolver().insert(MediaStore.getMediaScannerUri(), values);</span><br><span class="line"></span><br><span class="line">        sendBroadcast(<span class="hljs-keyword">new</span> Intent(Intent.ACTION_MEDIA_SCANNER_STARTED, uri));</span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">try</span> &#123;</span><br><span class="line">            <span class="hljs-keyword">if</span> (volumeName.equals(MediaProvider.EXTERNAL_VOLUME)) &#123;</span><br><span class="line">                openDatabase(volumeName);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            MediaScanner scanner = createMediaScanner();</span><br><span class="line">            scanner.scanDirectories(directories, volumeName);</span><br><span class="line">        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            Log.e(TAG, <span class="hljs-string">"exception in MediaScanner.scan()"</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        getContentResolver().delete(scanUri, <span class="hljs-keyword">null</span>, <span class="hljs-keyword">null</span>);</span><br><span class="line"></span><br><span class="line">    &#125; <span class="hljs-keyword">finally</span> &#123;</span><br><span class="line">        sendBroadcast(<span class="hljs-keyword">new</span> Intent(Intent.ACTION_MEDIA_SCANNER_FINISHED, uri));</span><br><span class="line">        mWakeLock.release();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">private</span> Uri <span class="hljs-title">scanFile</span><span class="hljs-params">(String path, String mimeType)</span> </span>&#123;</span><br><span class="line">    String volumeName = MediaProvider.EXTERNAL_VOLUME;</span><br><span class="line">    openDatabase(volumeName);</span><br><span class="line">    MediaScanner scanner = createMediaScanner();</span><br><span class="line">    <span class="hljs-keyword">try</span> &#123;</span><br><span class="line">        <span class="hljs-comment">// make sure the file path is in canonical form</span></span><br><span class="line">        String canonicalPath = <span class="hljs-keyword">new</span> File(path).getCanonicalPath();</span><br><span class="line">        <span class="hljs-keyword">return</span> scanner.scanSingleFile(canonicalPath, volumeName, mimeType);</span><br><span class="line">    &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        Log.e(TAG, <span class="hljs-string">"bad path "</span> + path + <span class="hljs-string">" in scanFile()"</span>, e);</span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> 两者都是会通过createMediaScanner创建MediaScanner对象，然后通过scanDirectories或者scanSingleFile来对卷或者文件进行扫描，下面我们就只针对scanDirectories进行分析。</p>
<p> MediaScanner.java (base\media\java\android\media)</p>
<figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">scanDirectories</span><span class="hljs-params">(String[] directories, String volumeName)</span> </span>&#123;</span><br><span class="line">      <span class="hljs-keyword">try</span> &#123;</span><br><span class="line">          <span class="hljs-keyword">long</span> start = System.currentTimeMillis();</span><br><span class="line">          initialize(volumeName);<span class="hljs-comment">//初始化数据库中的一些内容</span></span><br><span class="line">          prescan(<span class="hljs-keyword">null</span>, <span class="hljs-keyword">true</span>); <span class="hljs-comment">//预扫描</span></span><br><span class="line">          <span class="hljs-keyword">long</span> prescan = System.currentTimeMillis(); <span class="hljs-comment">//计算预扫描时间</span></span><br><span class="line"></span><br><span class="line">          <span class="hljs-keyword">if</span> (ENABLE_BULK_INSERTS) &#123;</span><br><span class="line">              <span class="hljs-comment">// create MediaInserter for bulk inserts</span></span><br><span class="line">              mMediaInserter = <span class="hljs-keyword">new</span> MediaInserter(mMediaProvider, mPackageName, <span class="hljs-number">500</span>);</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; directories.length; i++) &#123;</span><br><span class="line">              processDirectory(directories[i], mClient); <span class="hljs-comment">//扫描目录</span></span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="hljs-keyword">if</span> (ENABLE_BULK_INSERTS) &#123;</span><br><span class="line">              <span class="hljs-comment">// flush remaining inserts</span></span><br><span class="line">              mMediaInserter.flushAll();</span><br><span class="line">              mMediaInserter = <span class="hljs-keyword">null</span>;</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="hljs-keyword">long</span> scan = System.currentTimeMillis();</span><br><span class="line">          postscan(directories);</span><br><span class="line">          <span class="hljs-keyword">long</span> end = System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">          <span class="hljs-keyword">if</span> (<span class="hljs-keyword">false</span>) &#123;</span><br><span class="line">              Log.d(TAG, <span class="hljs-string">" prescan time: "</span> + (prescan - start) + <span class="hljs-string">"ms\n"</span>);</span><br><span class="line">              Log.d(TAG, <span class="hljs-string">"    scan time: "</span> + (scan - prescan) + <span class="hljs-string">"ms\n"</span>);</span><br><span class="line">              Log.d(TAG, <span class="hljs-string">"postscan time: "</span> + (end - scan) + <span class="hljs-string">"ms\n"</span>);</span><br><span class="line">              Log.d(TAG, <span class="hljs-string">"   total time: "</span> + (end - start) + <span class="hljs-string">"ms\n"</span>);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125; <span class="hljs-keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">          <span class="hljs-comment">// this might happen if the SD card is removed while the media scanner is running</span></span><br><span class="line">          Log.e(TAG, <span class="hljs-string">"SQLException in MediaScanner.scan()"</span>, e);</span><br><span class="line">      &#125; <span class="hljs-keyword">catch</span> (UnsupportedOperationException e) &#123;</span><br><span class="line">          <span class="hljs-comment">// this might happen if the SD card is removed while the media scanner is running</span></span><br><span class="line">          Log.e(TAG, <span class="hljs-string">"UnsupportedOperationException in MediaScanner.scan()"</span>, e);</span><br><span class="line">      &#125; <span class="hljs-keyword">catch</span> (RemoteException e) &#123;</span><br><span class="line">          Log.e(TAG, <span class="hljs-string">"RemoteException in MediaScanner.scan()"</span>, e);</span><br><span class="line">      &#125; <span class="hljs-keyword">finally</span> &#123;</span><br><span class="line">          releaseResources();</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p> 这里面比较重要的几个内容，一个是prescan，一个是processDirectory<br> 先看看prescan</p>
<figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">Uri limitUri = mFilesUri.buildUpon().appendQueryParameter(<span class="hljs-string">"limit"</span>, <span class="hljs-string">"1000"</span>).build(); <span class="hljs-comment">//查询条数为1000条</span></span><br><span class="line">mWasEmptyPriorToScan = <span class="hljs-keyword">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">while</span> (<span class="hljs-keyword">true</span>) &#123;</span><br><span class="line">    selectionArgs[<span class="hljs-number">0</span>] = <span class="hljs-string">""</span> + lastId;</span><br><span class="line">    <span class="hljs-keyword">if</span> (c != <span class="hljs-keyword">null</span>) &#123;</span><br><span class="line">        c.close();</span><br><span class="line">        c = <span class="hljs-keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    c = mMediaProvider.query(mPackageName, limitUri, FILES_PRESCAN_PROJECTION,</span><br><span class="line">            where, selectionArgs, MediaStore.Files.FileColumns._ID, <span class="hljs-keyword">null</span>);</span><br><span class="line">    <span class="hljs-keyword">if</span> (c == <span class="hljs-keyword">null</span>) &#123;</span><br><span class="line">        <span class="hljs-keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">int</span> num = c.getCount();</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">if</span> (num == <span class="hljs-number">0</span>) &#123;</span><br><span class="line">        <span class="hljs-keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    mWasEmptyPriorToScan = <span class="hljs-keyword">false</span>;</span><br><span class="line">    <span class="hljs-keyword">while</span> (c.moveToNext()) &#123;</span><br><span class="line">        <span class="hljs-keyword">long</span> rowId = c.getLong(FILES_PRESCAN_ID_COLUMN_INDEX);</span><br><span class="line">        String path = c.getString(FILES_PRESCAN_PATH_COLUMN_INDEX);</span><br><span class="line">        <span class="hljs-keyword">int</span> format = c.getInt(FILES_PRESCAN_FORMAT_COLUMN_INDEX);</span><br><span class="line">        <span class="hljs-keyword">long</span> lastModified = c.getLong(FILES_PRESCAN_DATE_MODIFIED_COLUMN_INDEX);</span><br><span class="line">        lastId = rowId;</span><br><span class="line">        <span class="hljs-comment">//查询id,路径，格式和最后修改时间</span></span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment">// Only consider entries with absolute path names.</span></span><br><span class="line">        <span class="hljs-comment">// This allows storing URIs in the database without the</span></span><br><span class="line">        <span class="hljs-comment">// media scanner removing them.</span></span><br><span class="line">        <span class="hljs-keyword">if</span> (path != <span class="hljs-keyword">null</span> &amp;&amp; path.startsWith(<span class="hljs-string">"/"</span>)) &#123;</span><br><span class="line">            <span class="hljs-keyword">boolean</span> exists = <span class="hljs-keyword">false</span>;</span><br><span class="line">            <span class="hljs-keyword">try</span> &#123;</span><br><span class="line">                exists = Os.access(path, android.system.OsConstants.F_OK);</span><br><span class="line">            &#125; <span class="hljs-keyword">catch</span> (ErrnoException e1) &#123;</span><br><span class="line">            &#125;</span><br><span class="line">            ......</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> 这里主要就是注意下最后修改时间，后面扫描的过程中应该会用到。<br> 再看下processDirectory,native方法<br> android_media_MediaScanner.cpp (base\media\jni)</p>
<figure class="highlight c hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span></span><br><span class="line">android_media_MediaScanner_processDirectory(</span><br><span class="line">        JNIEnv *env, jobject thiz, jstring path, jobject client)</span><br><span class="line">&#123;</span><br><span class="line">    ALOGV(<span class="hljs-string">"processDirectory"</span>);</span><br><span class="line">    MediaScanner *mp = getNativeScanner_l(env, thiz);</span><br><span class="line">    <span class="hljs-keyword">if</span> (mp == <span class="hljs-literal">NULL</span>) &#123;</span><br><span class="line">        jniThrowException(env, kRunTimeException, <span class="hljs-string">"No scanner available"</span>);</span><br><span class="line">        <span class="hljs-keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">if</span> (path == <span class="hljs-literal">NULL</span>) &#123;</span><br><span class="line">        jniThrowException(env, kIllegalArgumentException, <span class="hljs-literal">NULL</span>);</span><br><span class="line">        <span class="hljs-keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *pathStr = env-&gt;GetStringUTFChars(path, <span class="hljs-literal">NULL</span>);</span><br><span class="line">    <span class="hljs-keyword">if</span> (pathStr == <span class="hljs-literal">NULL</span>) &#123;  <span class="hljs-comment">// Out of memory</span></span><br><span class="line">        <span class="hljs-keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function">MyMediaScannerClient <span class="hljs-title">myClient</span><span class="hljs-params">(env, client)</span></span>;</span><br><span class="line">    MediaScanResult result = mp-&gt;processDirectory(pathStr, myClient);</span><br><span class="line">    <span class="hljs-keyword">if</span> (result == MEDIA_SCAN_RESULT_ERROR) &#123;</span><br><span class="line">        ALOGE(<span class="hljs-string">"An error occurred while scanning directory '%s'."</span>, pathStr);</span><br><span class="line">    &#125;</span><br><span class="line">    env-&gt;ReleaseStringUTFChars(path, pathStr);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> 从MediaScanner.java一直跟过来，忘记了MediaScanner.java中有一个比较重要的内容</p>
<figure class="highlight c hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">static</span> &#123;</span><br><span class="line">    System.loadLibrary(<span class="hljs-string">"media_jni"</span>);</span><br><span class="line">    native_init();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> 这里加载libmedia_jni.so即上面会用到的android_media_MediaScanner.cpp就是存在于这个so中，</p>
<figure class="highlight c hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> native final <span class="hljs-keyword">void</span> <span class="hljs-title">native_init</span><span class="hljs-params">()</span></span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight c hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span></span><br><span class="line">android_media_MediaScanner_native_init(JNIEnv *env)</span><br><span class="line">&#123;</span><br><span class="line">    ALOGV(<span class="hljs-string">"native_init"</span>);</span><br><span class="line">    jclass clazz = env-&gt;FindClass(kClassMediaScanner);</span><br><span class="line">    <span class="hljs-comment">//这里指的是static const char* const kClassMediaScanner ="android/media/MediaScanner";也就是后面会用到的MediaScanner.cpp</span></span><br><span class="line">    <span class="hljs-keyword">if</span> (clazz == <span class="hljs-literal">NULL</span>) &#123;</span><br><span class="line">        <span class="hljs-keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fields.context = env-&gt;GetFieldID(clazz, <span class="hljs-string">"mNativeContext"</span>, <span class="hljs-string">"J"</span>);</span><br><span class="line">    <span class="hljs-keyword">if</span> (fields.context == <span class="hljs-literal">NULL</span>) &#123;</span><br><span class="line">        <span class="hljs-keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> 在创建MediaScanner对象的过程中</p>
<figure class="highlight c hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MediaScanner</span><span class="hljs-params">(Context c)</span> </span>&#123;</span><br><span class="line">        native_setup();</span><br><span class="line">        mContext = c;</span><br><span class="line">        mPackageName = c.getPackageName();</span><br><span class="line">        mBitmapOptions.inSampleSize = <span class="hljs-number">1</span>;</span><br><span class="line">        mBitmapOptions.inJustDecodeBounds = <span class="hljs-literal">true</span>;</span><br><span class="line"></span><br><span class="line">        setDefaultRingtoneFileNames();</span><br><span class="line"></span><br><span class="line">        mExternalStoragePath = Environment.getExternalStorageDirectory().getAbsolutePath();</span><br><span class="line">        mExternalIsEmulated = Environment.isExternalStorageEmulated();</span><br><span class="line">        <span class="hljs-comment">//mClient.testGenreNameConverter();</span></span><br><span class="line">    &#125;</span><br><span class="line">......</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">private</span> native final <span class="hljs-keyword">void</span> <span class="hljs-title">native_setup</span><span class="hljs-params">()</span></span>;<span class="hljs-comment">//native方法</span></span><br></pre></td></tr></table></figure>

<figure class="highlight c hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span></span><br><span class="line">android_media_MediaScanner_native_setup(JNIEnv *env, jobject thiz)</span><br><span class="line">&#123;</span><br><span class="line">    ALOGV(<span class="hljs-string">"native_setup"</span>);</span><br><span class="line">    MediaScanner *mp = <span class="hljs-keyword">new</span> StagefrightMediaScanner;<span class="hljs-comment">//这里采用的是StagefrightMediaScanner</span></span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">if</span> (mp == <span class="hljs-literal">NULL</span>) &#123;</span><br><span class="line">        jniThrowException(env, kRunTimeException, <span class="hljs-string">"Out of memory"</span>);</span><br><span class="line">        <span class="hljs-keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    env-&gt;SetLongField(thiz, fields.context, (jlong)mp);<span class="hljs-comment">//set操作一下，后面会用到</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> 再回到processDirectory方法中来，<br> MediaScanner *mp = getNativeScanner_l(env, thiz);拿到MediaScaner的cpp对象<br> MyMediaScannerClient myClient(env, client); //创建MyMediaScannerClient对象，而这里传入的client是MediaScanner.java中的MyMediaScannerClient对象<br> MediaScanResult result = mp-&gt;processDirectory(pathStr, myClient);<br> //执行processDirectory方法，传入myClient对象<br> 这样传来传去无非就是想保存下当前的java侧的一个client,后面会有妙用？<br> StagefrightMediaScanner继承MediaScanner，没有实现processDirectory方法，使用的是父类中的方法</p>
<figure class="highlight c hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">MediaScanResult MediaScanner::processDirectory(</span><br><span class="line">        <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *path, MediaScannerClient &amp;client) &#123;</span><br><span class="line">    ......</span><br><span class="line">    MediaScanResult result = doProcessDirectory(pathBuffer, pathRemaining, client, <span class="hljs-literal">false</span>);</span><br><span class="line">    <span class="hljs-built_in">free</span>(pathBuffer);</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">MediaScanResult MediaScanner::doProcessDirectory(</span><br><span class="line">        <span class="hljs-keyword">char</span> *path, <span class="hljs-keyword">int</span> pathRemaining, MediaScannerClient &amp;client, <span class="hljs-keyword">bool</span> noMedia) &#123;</span><br><span class="line">     ......</span><br><span class="line">     <span class="hljs-keyword">while</span> ((entry = readdir(dir))) &#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (doProcessDirectoryEntry(path, pathRemaining, client, noMedia, entry, fileSpot)</span><br><span class="line">                == MEDIA_SCAN_RESULT_ERROR) &#123;</span><br><span class="line">            result = MEDIA_SCAN_RESULT_ERROR;</span><br><span class="line">            <span class="hljs-keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">MediaScanResult MediaScanner::doProcessDirectoryEntry(</span><br><span class="line">        <span class="hljs-keyword">char</span> *path, <span class="hljs-keyword">int</span> pathRemaining, MediaScannerClient &amp;client, <span class="hljs-keyword">bool</span> noMedia,</span><br><span class="line">        struct dirent* entry, <span class="hljs-keyword">char</span>* fileSpot) &#123;</span><br><span class="line">    ......</span><br><span class="line">    <span class="hljs-keyword">if</span> (type == DT_DIR) &#123; <span class="hljs-comment">//如果是目录，继续遍历子节点</span></span><br><span class="line">        <span class="hljs-keyword">bool</span> childNoMedia = noMedia;</span><br><span class="line">        <span class="hljs-comment">// set noMedia flag on directories with a name that starts with '.'</span></span><br><span class="line">        <span class="hljs-comment">// for example, the Mac ".Trashes" directory</span></span><br><span class="line">        <span class="hljs-keyword">if</span> (name[<span class="hljs-number">0</span>] == <span class="hljs-string">'.'</span>)</span><br><span class="line">            childNoMedia = <span class="hljs-literal">true</span>;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment">// report the directory to the client</span></span><br><span class="line">        <span class="hljs-keyword">if</span> (stat(path, &amp;statbuf) == <span class="hljs-number">0</span>) &#123;</span><br><span class="line">            <span class="hljs-keyword">status_t</span> status = client.scanFile(path, statbuf.st_mtime, <span class="hljs-number">0</span>,</span><br><span class="line">                    <span class="hljs-literal">true</span> <span class="hljs-comment">/*isDirectory*/</span>, childNoMedia);</span><br><span class="line">            <span class="hljs-keyword">if</span> (status) &#123;</span><br><span class="line">                <span class="hljs-keyword">return</span> MEDIA_SCAN_RESULT_ERROR;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment">// and now process its contents</span></span><br><span class="line">        <span class="hljs-built_in">strcat</span>(fileSpot, <span class="hljs-string">"/"</span>);</span><br><span class="line">        MediaScanResult result = doProcessDirectory(path, pathRemaining - nameLength - <span class="hljs-number">1</span>,</span><br><span class="line">                client, childNoMedia);</span><br><span class="line">        <span class="hljs-keyword">if</span> (result == MEDIA_SCAN_RESULT_ERROR) &#123;</span><br><span class="line">            <span class="hljs-keyword">return</span> MEDIA_SCAN_RESULT_ERROR;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (type == DT_REG) &#123; <span class="hljs-comment">//如果是普通文件，执行scanFile操作</span></span><br><span class="line">        stat(path, &amp;statbuf);</span><br><span class="line">        <span class="hljs-keyword">status_t</span> status = client.scanFile(path, statbuf.st_mtime, statbuf.st_size,</span><br><span class="line">                <span class="hljs-literal">false</span> <span class="hljs-comment">/*isDirectory*/</span>, noMedia);</span><br><span class="line">        ......</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p> 这里注意一下，使用的client就是之前传入的参数，最终会调用会MediaScanner.java中MyMediaScannerClient中的scanFile方法</p>
<figure class="highlight c hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">scanFile</span><span class="hljs-params">(String path, <span class="hljs-keyword">long</span> lastModified, <span class="hljs-keyword">long</span> fileSize,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">        boolean isDirectory, boolean noMedia)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-comment">// This is the callback funtion from native codes.</span></span><br><span class="line">    <span class="hljs-comment">// Log.v(TAG, "scanFile: "+path);</span></span><br><span class="line">    doScanFile(path, null, lastModified, fileSize, isDirectory, <span class="hljs-literal">false</span>, noMedia);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> Uri <span class="hljs-title">doScanFile</span><span class="hljs-params">(String path, String mimeType, <span class="hljs-keyword">long</span> lastModified,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">         <span class="hljs-keyword">long</span> fileSize, boolean isDirectory, boolean scanAlways, boolean noMedia)</span> </span>&#123;</span><br><span class="line">      ......</span><br><span class="line">      <span class="hljs-keyword">try</span> &#123;</span><br><span class="line">         FileEntry entry = beginFile(path, mimeType, lastModified,</span><br><span class="line">                 fileSize, isDirectory, noMedia);</span><br><span class="line">                 <span class="hljs-comment">//beginFile创建FileEntry</span></span><br><span class="line">         ......</span><br><span class="line">          <span class="hljs-comment">// rescan for metadata if file was modified since last scan</span></span><br><span class="line">         <span class="hljs-keyword">if</span> (entry != null &amp;&amp; (entry.mLastModifiedChanged || scanAlways)) &#123;</span><br><span class="line">             <span class="hljs-keyword">if</span> (noMedia) &#123;</span><br><span class="line">                 result = endFile(entry, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>);</span><br><span class="line">             &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">                ......</span><br><span class="line">                  <span class="hljs-comment">// we only extract metadata for audio and video files</span></span><br><span class="line">                 <span class="hljs-keyword">if</span> (isaudio || isvideo) &#123;</span><br><span class="line">                     processFile(path, mimeType, <span class="hljs-keyword">this</span>);<span class="hljs-comment">//处理音频视频文件</span></span><br><span class="line">                 &#125;</span><br><span class="line"></span><br><span class="line">                 <span class="hljs-keyword">if</span> (isimage) &#123;</span><br><span class="line">                     processImageFile(path);<span class="hljs-comment">//处理图片文件</span></span><br><span class="line">                 &#125;</span><br><span class="line"></span><br><span class="line">                 result = endFile(entry, ringtones, notifications, alarms, music, podcasts);</span><br><span class="line">             &#125;</span><br><span class="line">             ......</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p> 下面看下音频文件的处理<br> processFile(path, mimeType, this)，注意这里传入的参数有路径和mimetype</p>
<figure class="highlight c hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">private</span> native <span class="hljs-keyword">void</span> <span class="hljs-title">processFile</span><span class="hljs-params">(String path, String mimeType, MediaScannerClient client)</span></span>;</span><br></pre></td></tr></table></figure>

<p> 跟到android_media_MediaScanner.cpp</p>
<figure class="highlight c hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function">MyMediaScannerClient <span class="hljs-title">myClient</span><span class="hljs-params">(env, client)</span></span>;</span><br><span class="line">MediaScanResult result = mp-&gt;processFile(pathStr, mimeTypeStr, myClient);</span><br></pre></td></tr></table></figure>

<p> 然后跟到<br> StagefrightMediaScanner.cpp (av\include\media\stagefright)</p>
<figure class="highlight c hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">MediaScanResult StagefrightMediaScanner::processFile(</span><br><span class="line">        <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *path, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *mimeType,</span><br><span class="line">        MediaScannerClient &amp;client) &#123;</span><br><span class="line">    ALOGV(<span class="hljs-string">"processFile '%s'."</span>, path);</span><br><span class="line"></span><br><span class="line">    client.setLocale(locale());</span><br><span class="line">    client.beginFile();</span><br><span class="line">    MediaScanResult result = processFileInternal(path, mimeType, client);</span><br><span class="line">    client.endFile();</span><br><span class="line">    <span class="hljs-keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">MediaScanResult StagefrightMediaScanner::processFileInternal(</span><br><span class="line">        <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *path, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> * <span class="hljs-comment">/* mimeType */</span>,</span><br><span class="line">        MediaScannerClient &amp;client) &#123;</span><br><span class="line">    ......</span><br><span class="line">    sp&lt;MediaMetadataRetriever&gt; mRetriever(<span class="hljs-keyword">new</span> MediaMetadataRetriever);</span><br><span class="line">    <span class="hljs-comment">//创建解析实例</span></span><br><span class="line">    <span class="hljs-keyword">int</span> fd = open(path, O_RDONLY | O_LARGEFILE);</span><br><span class="line">    <span class="hljs-keyword">status_t</span> status;</span><br><span class="line">    <span class="hljs-keyword">if</span> (fd &lt; <span class="hljs-number">0</span>) &#123; <span class="hljs-comment">//设置数据源</span></span><br><span class="line">        <span class="hljs-comment">// couldn't open it locally, maybe the media server can?</span></span><br><span class="line">        status = mRetriever-&gt;setDataSource(<span class="hljs-literal">NULL</span> <span class="hljs-comment">/* httpService */</span>, path);</span><br><span class="line">    &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">        status = mRetriever-&gt;setDataSource(fd, <span class="hljs-number">0</span>, <span class="hljs-number">0x7ffffffffffffff</span>L);</span><br><span class="line">        close(fd);</span><br><span class="line">    &#125;</span><br><span class="line">    ......</span><br><span class="line">    <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *value;</span><br><span class="line">    <span class="hljs-keyword">if</span> ((value = mRetriever-&gt;extractMetadata(<span class="hljs-comment">//解析元数据</span></span><br><span class="line">                    METADATA_KEY_MIMETYPE)) != <span class="hljs-literal">NULL</span>) &#123;</span><br><span class="line">        status = client.setMimeType(value);</span><br><span class="line">        <span class="hljs-keyword">if</span> (status) &#123;</span><br><span class="line">            <span class="hljs-keyword">return</span> MEDIA_SCAN_RESULT_ERROR;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">KeyMap</span> &#123;</span></span><br><span class="line">        <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *tag;</span><br><span class="line">        <span class="hljs-keyword">int</span> key;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> KeyMap kKeyMap[] = &#123;</span><br><span class="line">        &#123; <span class="hljs-string">"tracknumber"</span>, METADATA_KEY_CD_TRACK_NUMBER &#125;,</span><br><span class="line">        &#123; <span class="hljs-string">"discnumber"</span>, METADATA_KEY_DISC_NUMBER &#125;,</span><br><span class="line">        &#123; <span class="hljs-string">"album"</span>, METADATA_KEY_ALBUM &#125;,</span><br><span class="line">        &#123; <span class="hljs-string">"artist"</span>, METADATA_KEY_ARTIST &#125;,</span><br><span class="line">        &#123; <span class="hljs-string">"albumartist"</span>, METADATA_KEY_ALBUMARTIST &#125;,</span><br><span class="line">        &#123; <span class="hljs-string">"composer"</span>, METADATA_KEY_COMPOSER &#125;,</span><br><span class="line">        &#123; <span class="hljs-string">"genre"</span>, METADATA_KEY_GENRE &#125;,</span><br><span class="line">        &#123; <span class="hljs-string">"title"</span>, METADATA_KEY_TITLE &#125;,</span><br><span class="line">        &#123; <span class="hljs-string">"year"</span>, METADATA_KEY_YEAR &#125;,</span><br><span class="line">        &#123; <span class="hljs-string">"duration"</span>, METADATA_KEY_DURATION &#125;,</span><br><span class="line">        &#123; <span class="hljs-string">"writer"</span>, METADATA_KEY_WRITER &#125;,</span><br><span class="line">        &#123; <span class="hljs-string">"compilation"</span>, METADATA_KEY_COMPILATION &#125;,</span><br><span class="line">        &#123; <span class="hljs-string">"isdrm"</span>, METADATA_KEY_IS_DRM &#125;,</span><br><span class="line">        &#123; <span class="hljs-string">"width"</span>, METADATA_KEY_VIDEO_WIDTH &#125;,</span><br><span class="line">        &#123; <span class="hljs-string">"height"</span>, METADATA_KEY_VIDEO_HEIGHT &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">size_t</span> kNumEntries = <span class="hljs-keyword">sizeof</span>(kKeyMap) / <span class="hljs-keyword">sizeof</span>(kKeyMap[<span class="hljs-number">0</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">size_t</span> i = <span class="hljs-number">0</span>; i &lt; kNumEntries; ++i) &#123;</span><br><span class="line">        <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *value;</span><br><span class="line">        <span class="hljs-keyword">if</span> ((value = mRetriever-&gt;extractMetadata(kKeyMap[i].key)) != <span class="hljs-literal">NULL</span>) &#123;</span><br><span class="line">            status = client.addStringTag(kKeyMap[i].tag, value);</span><br><span class="line">            <span class="hljs-keyword">if</span> (status != OK) &#123;</span><br><span class="line">                <span class="hljs-keyword">return</span> MEDIA_SCAN_RESULT_ERROR;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">return</span> MEDIA_SCAN_RESULT_OK;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> 这里创建的MediaMetadataRetriever并不是MediaMetadataRetriver本身，而是一个之类，StagefrightMetadataRetriver，中间有一个过程，我们来看下。</p>
<figure class="highlight c hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">MediaMetadataRetriever::MediaMetadataRetriever()</span><br><span class="line">&#123;</span><br><span class="line">    ALOGV(<span class="hljs-string">"constructor"</span>);</span><br><span class="line">    <span class="hljs-keyword">const</span> sp&lt;IMediaPlayerService&gt;&amp; service(getService());</span><br><span class="line">    <span class="hljs-keyword">if</span> (service == <span class="hljs-number">0</span>) &#123;</span><br><span class="line">        ALOGE(<span class="hljs-string">"failed to obtain MediaMetadataRetrieverService"</span>);</span><br><span class="line">        <span class="hljs-keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    sp&lt;IMediaMetadataRetriever&gt; retriever(service-&gt;createMetadataRetriever());</span><br><span class="line">    <span class="hljs-comment">//创建元数据解析对象</span></span><br><span class="line">    <span class="hljs-keyword">if</span> (retriever == <span class="hljs-number">0</span>) &#123;</span><br><span class="line">        ALOGE(<span class="hljs-string">"failed to create IMediaMetadataRetriever object from server"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    mRetriever = retriever;<span class="hljs-comment">//赋值给mRetriver</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> 这里的service是MediaPlayerService，这里使用的代理，实现直接看MediaPlayerService.cpp中的函数</p>
<figure class="highlight c hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sp&lt;IMediaMetadataRetriever&gt; MediaPlayerService::createMetadataRetriever()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="hljs-keyword">pid_t</span> pid = IPCThreadState::self()-&gt;getCallingPid();</span><br><span class="line">    sp&lt;MetadataRetrieverClient&gt; retriever = <span class="hljs-keyword">new</span> MetadataRetrieverClient(pid);</span><br><span class="line">    <span class="hljs-comment">//这里创建了MetadataRetrieverClient对象</span></span><br><span class="line">    ALOGV(<span class="hljs-string">"Create new media retriever from pid %d"</span>, pid);</span><br><span class="line">    <span class="hljs-keyword">return</span> retriever;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> MetadataRetrieverClient.cpp (av\media\libmediaplayerservice)</p>
<figure class="highlight c hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">MetadataRetrieverClient::MetadataRetrieverClient(<span class="hljs-keyword">pid_t</span> pid)</span><br><span class="line">&#123;</span><br><span class="line">    ALOGV(<span class="hljs-string">"MetadataRetrieverClient constructor pid(%d)"</span>, pid);</span><br><span class="line">    mPid = pid;</span><br><span class="line">    mThumbnail = <span class="hljs-literal">NULL</span>;</span><br><span class="line">    mAlbumArt = <span class="hljs-literal">NULL</span>;</span><br><span class="line">    mRetriever = <span class="hljs-literal">NULL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> 显然上面创建的东西只是一个空壳，继续往下看<br> 在processFileInternal函数中setDataSource函数中同样会跟到</p>
<figure class="highlight c hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">status_t</span> MetadataRetrieverClient::setDataSource(<span class="hljs-keyword">int</span> fd, <span class="hljs-keyword">int64_t</span> offset, <span class="hljs-keyword">int64_t</span> length)</span><br><span class="line">&#123;</span><br><span class="line">    ......</span><br><span class="line">    player_type playerType =</span><br><span class="line">        MediaPlayerFactory::getPlayerType(<span class="hljs-literal">NULL</span> <span class="hljs-comment">/* client */</span>,</span><br><span class="line">                                          fd,</span><br><span class="line">                                          offset,</span><br><span class="line">                                          length);</span><br><span class="line">    <span class="hljs-comment">//获取playertype方便后面选择对应的元数据解析器</span></span><br><span class="line">    ALOGV(<span class="hljs-string">"player type = %d"</span>, playerType);</span><br><span class="line">    sp&lt;MediaMetadataRetrieverBase&gt; p = createRetriever(playerType);<span class="hljs-comment">//创建实际的metadataretriver</span></span><br><span class="line">    <span class="hljs-keyword">if</span> (p == <span class="hljs-literal">NULL</span>) &#123;</span><br><span class="line">        ::close(fd);</span><br><span class="line">        <span class="hljs-keyword">return</span> NO_INIT;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">status_t</span> status = p-&gt;setDataSource(fd, offset, length);</span><br><span class="line">    <span class="hljs-keyword">if</span> (status == NO_ERROR) mRetriever = p;</span><br><span class="line">    ::close(fd);</span><br><span class="line">    <span class="hljs-keyword">return</span> status;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">static</span> sp&lt;MediaMetadataRetrieverBase&gt; createRetriever(player_type playerType)</span><br><span class="line">&#123;</span><br><span class="line">    sp&lt;MediaMetadataRetrieverBase&gt; p;</span><br><span class="line">    <span class="hljs-keyword">switch</span> (playerType) &#123;</span><br><span class="line">        <span class="hljs-keyword">case</span> STAGEFRIGHT_PLAYER:</span><br><span class="line">        <span class="hljs-keyword">case</span> NU_PLAYER:</span><br><span class="line">        &#123;</span><br><span class="line">            p = <span class="hljs-keyword">new</span> StagefrightMetadataRetriever;<span class="hljs-comment">//这里才是我们实际使用的MedadataRetriver</span></span><br><span class="line">            <span class="hljs-keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">case</span> SONIVOX_PLAYER:</span><br><span class="line">            ALOGV(<span class="hljs-string">"create midi metadata retriever"</span>);</span><br><span class="line">            p = <span class="hljs-keyword">new</span> MidiMetadataRetriever();</span><br><span class="line">            <span class="hljs-keyword">break</span>;</span><br><span class="line">        <span class="hljs-keyword">default</span>:</span><br><span class="line">            <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span></span></span><br><span class="line">            <span class="hljs-comment">// support for TEST_PLAYER</span></span><br><span class="line">            ALOGE(<span class="hljs-string">"player type %d is not supported"</span>,  playerType);</span><br><span class="line">            <span class="hljs-keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">if</span> (p == <span class="hljs-literal">NULL</span>) &#123;</span><br><span class="line">        ALOGE(<span class="hljs-string">"failed to create a retriever object"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">return</span> p;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> StagefrightMetadataRetriever.cpp (av\media\libstagefright)<br> 那么然后执行setDataSouce()</p>
<figure class="highlight c hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// Warning caller retains ownership of the filedescriptor! Dup it if necessary.</span></span><br><span class="line"><span class="hljs-keyword">status_t</span> StagefrightMetadataRetriever::setDataSource(</span><br><span class="line">        <span class="hljs-keyword">int</span> fd, <span class="hljs-keyword">int64_t</span> offset, <span class="hljs-keyword">int64_t</span> length) &#123;</span><br><span class="line">    ......</span><br><span class="line">    mExtractor = MediaExtractor::Create(mSource);<span class="hljs-comment">//创建媒体解析器</span></span><br><span class="line">    ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> setDataSouce()有两个方法，传入的参数不用，另外一个是针对在线媒体的<br> 然后就是创建媒体解析器<br> MediaExtractor.cpp (av\media\libstagefright)</p>
<figure class="highlight c hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">sp&lt;MediaExtractor&gt; MediaExtractor::Create(</span><br><span class="line">        <span class="hljs-keyword">const</span> sp&lt;DataSource&gt; &amp;source, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *mime) &#123;</span><br><span class="line">    ......</span><br><span class="line">    <span class="hljs-comment">//如果Mimetype为null,匹配出最符合的mimetype</span></span><br><span class="line">    <span class="hljs-keyword">if</span> (mime == <span class="hljs-literal">NULL</span>) &#123;</span><br><span class="line">        <span class="hljs-keyword">float</span> confidence;</span><br><span class="line">        <span class="hljs-keyword">if</span> (!source-&gt;sniff(&amp;tmp, &amp;confidence, &amp;meta)) &#123;</span><br><span class="line">            ALOGV(<span class="hljs-string">"FAILED to autodetect media content."</span>);</span><br><span class="line"></span><br><span class="line">            <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        mime = tmp.<span class="hljs-built_in">string</span>();</span><br><span class="line">        ALOGV(<span class="hljs-string">"Autodetected media content as '%s' with confidence %.2f"</span>,</span><br><span class="line">             mime, confidence);</span><br><span class="line">    &#125;</span><br><span class="line">    ......</span><br><span class="line">    MediaExtractor *ret = <span class="hljs-literal">NULL</span>;</span><br><span class="line">    <span class="hljs-comment">//不同的mimetype对应不同的extractor</span></span><br><span class="line">    <span class="hljs-keyword">if</span> (!strcasecmp(mime, MEDIA_MIMETYPE_CONTAINER_MPEG4)</span><br><span class="line">            || !strcasecmp(mime, <span class="hljs-string">"audio/mp4"</span>)) &#123;</span><br><span class="line">        ret = <span class="hljs-keyword">new</span> MPEG4Extractor(source);</span><br><span class="line">    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!strcasecmp(mime, MEDIA_MIMETYPE_AUDIO_MPEG)) &#123;</span><br><span class="line">        ret = <span class="hljs-keyword">new</span> MP3Extractor(source, meta);</span><br><span class="line">    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!strcasecmp(mime, MEDIA_MIMETYPE_AUDIO_AMR_NB)</span><br><span class="line">            || !strcasecmp(mime, MEDIA_MIMETYPE_AUDIO_AMR_WB)) &#123;</span><br><span class="line">        ret = <span class="hljs-keyword">new</span> AMRExtractor(source);</span><br><span class="line">    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!strcasecmp(mime, MEDIA_MIMETYPE_AUDIO_FLAC)) &#123;</span><br><span class="line">        ret = <span class="hljs-keyword">new</span> FLACExtractor(source);</span><br><span class="line">    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!strcasecmp(mime, MEDIA_MIMETYPE_CONTAINER_WAV)) &#123;</span><br><span class="line">        ret = <span class="hljs-keyword">new</span> WAVExtractor(source);</span><br><span class="line">    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!strcasecmp(mime, MEDIA_MIMETYPE_CONTAINER_OGG)) &#123;</span><br><span class="line">        ret = <span class="hljs-keyword">new</span> OggExtractor(source);</span><br><span class="line">    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!strcasecmp(mime, MEDIA_MIMETYPE_CONTAINER_MATROSKA)) &#123;</span><br><span class="line">        ret = <span class="hljs-keyword">new</span> MatroskaExtractor(source);</span><br><span class="line">    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!strcasecmp(mime, MEDIA_MIMETYPE_CONTAINER_MPEG2TS)) &#123;</span><br><span class="line">        ret = <span class="hljs-keyword">new</span> MPEG2TSExtractor(source);</span><br><span class="line">    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!strcasecmp(mime, MEDIA_MIMETYPE_CONTAINER_WVM)) &#123;</span><br><span class="line">        <span class="hljs-comment">// Return now.  WVExtractor should not have the DrmFlag set in the block below.</span></span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> WVMExtractor(source);</span><br><span class="line">    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!strcasecmp(mime, MEDIA_MIMETYPE_AUDIO_AAC_ADTS)) &#123;</span><br><span class="line">        ret = <span class="hljs-keyword">new</span> AACExtractor(source, meta);</span><br><span class="line">    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!strcasecmp(mime, MEDIA_MIMETYPE_CONTAINER_MPEG2PS)) &#123;</span><br><span class="line">        ret = <span class="hljs-keyword">new</span> MPEG2PSExtractor(source);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">if</span> (ret != <span class="hljs-literal">NULL</span>) &#123;</span><br><span class="line">       <span class="hljs-keyword">if</span> (isDrm) &#123;</span><br><span class="line">           ret-&gt;setDrmFlag(<span class="hljs-literal">true</span>);</span><br><span class="line">       &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">           ret-&gt;setDrmFlag(<span class="hljs-literal">false</span>);</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">return</span> ret;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> 针对mimetype为空的情况<br> DataSource.cpp (av\media\libstagefright)</p>
<figure class="highlight c hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">bool</span> DataSource::sniff(</span><br><span class="line">        String8 *mimeType, <span class="hljs-keyword">float</span> *confidence, sp&lt;AMessage&gt; *meta) &#123;</span><br><span class="line">    *mimeType = <span class="hljs-string">""</span>;<span class="hljs-comment">//mimetype</span></span><br><span class="line">    *confidence = <span class="hljs-number">0.0f</span>;<span class="hljs-comment">//可信度</span></span><br><span class="line">    meta-&gt;clear();</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line">        Mutex::<span class="hljs-function">Autolock <span class="hljs-title">autoLock</span><span class="hljs-params">(gSnifferMutex)</span></span>;</span><br><span class="line">        <span class="hljs-keyword">if</span> (!gSniffersRegistered) &#123;<span class="hljs-comment">//如果没有嗅探器直接return</span></span><br><span class="line">            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">for</span> (List&lt;SnifferFunc&gt;::iterator it = gSniffers.begin();</span><br><span class="line">         it != gSniffers.end(); ++it) &#123;</span><br><span class="line">        String8 newMimeType;</span><br><span class="line">        <span class="hljs-keyword">float</span> newConfidence;</span><br><span class="line">        sp&lt;AMessage&gt; newMeta;</span><br><span class="line">        <span class="hljs-keyword">if</span> ((*it)(<span class="hljs-keyword">this</span>, &amp;newMimeType, &amp;newConfidence, &amp;newMeta)) &#123;</span><br><span class="line">            <span class="hljs-keyword">if</span> (newConfidence &gt; *confidence) &#123;</span><br><span class="line">                *mimeType = newMimeType;</span><br><span class="line">                *confidence = newConfidence;</span><br><span class="line">                *meta = newMeta;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-comment">//遍历所有的嗅探器，找到可信度最高的</span></span><br><span class="line">    <span class="hljs-keyword">return</span> *confidence &gt; <span class="hljs-number">0.0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> 到这里对应的mimetype和extractor都明确了，再回到StagefrightMediaScanner.cpp中processFileInternal函数，执行完了setDataSouce，执行extractMetadata，依然是跟到StagefrightMetadataRetriver.cpp中</p>
<figure class="highlight c hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *StagefrightMetadataRetriever::extractMetadata(<span class="hljs-keyword">int</span> keyCode) &#123;</span><br><span class="line">    <span class="hljs-keyword">if</span> (mExtractor == <span class="hljs-literal">NULL</span>) &#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">if</span> (!mParsedMetaData) &#123;</span><br><span class="line">        parseMetaData();<span class="hljs-comment">//如果没有解析，就解析一下</span></span><br><span class="line"></span><br><span class="line">        mParsedMetaData = <span class="hljs-literal">true</span>;<span class="hljs-comment">//标识一下，已经解析过了</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">ssize_t</span> index = mMetaData.indexOfKey(keyCode); </span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">if</span> (index &lt; <span class="hljs-number">0</span>) &#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">return</span> mMetaData.valueAt(index).<span class="hljs-built_in">string</span>();<span class="hljs-comment">//如果解析过就直接放回对应的内容即可</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> 再看下parseMetaData函数，这个函数比较长，主要看下一部分</p>
<figure class="highlight c hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> Map kMap[] = &#123;</span><br><span class="line">    &#123; kKeyMIMEType, METADATA_KEY_MIMETYPE, <span class="hljs-literal">NULL</span> &#125;,</span><br><span class="line">    &#123; kKeyCDTrackNumber, METADATA_KEY_CD_TRACK_NUMBER, <span class="hljs-string">"tracknumber"</span> &#125;,</span><br><span class="line">    &#123; kKeyDiscNumber, METADATA_KEY_DISC_NUMBER, <span class="hljs-string">"discnumber"</span> &#125;,</span><br><span class="line">    &#123; kKeyAlbum, METADATA_KEY_ALBUM, <span class="hljs-string">"album"</span> &#125;,</span><br><span class="line">    &#123; kKeyArtist, METADATA_KEY_ARTIST, <span class="hljs-string">"artist"</span> &#125;,</span><br><span class="line">    &#123; kKeyAlbumArtist, METADATA_KEY_ALBUMARTIST, <span class="hljs-string">"albumartist"</span> &#125;,</span><br><span class="line">    &#123; kKeyAuthor, METADATA_KEY_AUTHOR, <span class="hljs-literal">NULL</span> &#125;,</span><br><span class="line">    &#123; kKeyComposer, METADATA_KEY_COMPOSER, <span class="hljs-string">"composer"</span> &#125;,</span><br><span class="line">    &#123; kKeyDate, METADATA_KEY_DATE, <span class="hljs-literal">NULL</span> &#125;,</span><br><span class="line">    &#123; kKeyGenre, METADATA_KEY_GENRE, <span class="hljs-string">"genre"</span> &#125;,</span><br><span class="line">    &#123; kKeyTitle, METADATA_KEY_TITLE, <span class="hljs-string">"title"</span> &#125;,</span><br><span class="line">    &#123; kKeyYear, METADATA_KEY_YEAR, <span class="hljs-string">"year"</span> &#125;,</span><br><span class="line">    &#123; kKeyWriter, METADATA_KEY_WRITER, <span class="hljs-string">"writer"</span> &#125;,</span><br><span class="line">    &#123; kKeyCompilation, METADATA_KEY_COMPILATION, <span class="hljs-string">"compilation"</span> &#125;,</span><br><span class="line">    &#123; kKeyLocation, METADATA_KEY_LOCATION, <span class="hljs-literal">NULL</span> &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">size_t</span> kNumMapEntries = <span class="hljs-keyword">sizeof</span>(kMap) / <span class="hljs-keyword">sizeof</span>(kMap[<span class="hljs-number">0</span>]);</span><br><span class="line"><span class="hljs-comment">//创建字符集探测器，这个内容是L版本新加的内容</span></span><br><span class="line">CharacterEncodingDetector *detector = <span class="hljs-keyword">new</span> CharacterEncodingDetector();</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">size_t</span> i = <span class="hljs-number">0</span>; i &lt; kNumMapEntries; ++i) &#123;</span><br><span class="line">    <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *value;</span><br><span class="line">    <span class="hljs-keyword">if</span> (meta-&gt;findCString(kMap[i].from, &amp;value)) &#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (kMap[i].name) &#123;</span><br><span class="line">            <span class="hljs-comment">// add to charset detector</span></span><br><span class="line">            detector-&gt;addTag(kMap[i].name, value);<span class="hljs-comment">//加入探测器</span></span><br><span class="line">        &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">            <span class="hljs-comment">// directly add to output list</span></span><br><span class="line">            mMetaData.add(kMap[i].to, String8(value));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">detector-&gt;detectAndConvert();<span class="hljs-comment">//探测器中执行字符集的探测和转换</span></span><br><span class="line"><span class="hljs-keyword">int</span> size = detector-&gt;size();</span><br><span class="line"><span class="hljs-keyword">if</span> (size) &#123;</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">        <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *name;</span><br><span class="line">        <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *value;</span><br><span class="line">        detector-&gt;getTag(i, &amp;name, &amp;value);</span><br><span class="line">        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">size_t</span> j = <span class="hljs-number">0</span>; j &lt; kNumMapEntries; ++j) &#123;</span><br><span class="line">            <span class="hljs-keyword">if</span> (kMap[j].name &amp;&amp; !<span class="hljs-built_in">strcmp</span>(kMap[j].name, name)) &#123;</span><br><span class="line">                mMetaData.add(kMap[j].to, String8(value));<span class="hljs-comment">//最后的数据保存</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> 此函数中其他的内容也是解析一些其他的元数据报保存下来。<br> 再回到processFileInternal中，在解析完元数据之后</p>
<figure class="highlight c hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">size_t</span> i = <span class="hljs-number">0</span>; i &lt; kNumEntries; ++i) &#123;</span><br><span class="line">    <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *value;</span><br><span class="line">    <span class="hljs-keyword">if</span> ((value = mRetriever-&gt;extractMetadata(kKeyMap[i].key)) != <span class="hljs-literal">NULL</span>) &#123;</span><br><span class="line">        status = client.addStringTag(kKeyMap[i].tag, value);</span><br><span class="line">        <span class="hljs-keyword">if</span> (status != OK) &#123;</span><br><span class="line">            <span class="hljs-keyword">return</span> MEDIA_SCAN_RESULT_ERROR;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> 将数据一个一个通过client的addStringTag往上传递，跟下此过程<br> MediaScannerClient.cpp (av\media\libmedia)</p>
<figure class="highlight c hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">status_t</span> MediaScannerClient::addStringTag(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* name, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* value)</span><br><span class="line">&#123;</span><br><span class="line">    handleStringTag(name, value);</span><br><span class="line">    <span class="hljs-keyword">return</span> OK;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> 最后会回到MediaScanner.java中的handleStringTag()</p>
<figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">handleStringTag</span><span class="hljs-params">(String name, String value)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">if</span> (name.equalsIgnoreCase(<span class="hljs-string">"title"</span>) || name.startsWith(<span class="hljs-string">"title;"</span>)) &#123;</span><br><span class="line">        <span class="hljs-comment">// Don't trim() here, to preserve the special \001 character</span></span><br><span class="line">        <span class="hljs-comment">// used to force sorting. The media provider will trim() before</span></span><br><span class="line">        <span class="hljs-comment">// inserting the title in to the database.</span></span><br><span class="line">        mTitle = value;</span><br><span class="line">    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (name.equalsIgnoreCase(<span class="hljs-string">"artist"</span>) || name.startsWith(<span class="hljs-string">"artist;"</span>)) &#123;</span><br><span class="line">        mArtist = value.trim();</span><br><span class="line">    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (name.equalsIgnoreCase(<span class="hljs-string">"albumartist"</span>) || name.startsWith(<span class="hljs-string">"albumartist;"</span>)</span><br><span class="line">            || name.equalsIgnoreCase(<span class="hljs-string">"band"</span>) || name.startsWith(<span class="hljs-string">"band;"</span>)) &#123;</span><br><span class="line">        mAlbumArtist = value.trim();</span><br><span class="line">    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (name.equalsIgnoreCase(<span class="hljs-string">"album"</span>) || name.startsWith(<span class="hljs-string">"album;"</span>)) &#123;</span><br><span class="line">        mAlbum = value.trim();</span><br><span class="line">    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (name.equalsIgnoreCase(<span class="hljs-string">"composer"</span>) || name.startsWith(<span class="hljs-string">"composer;"</span>)) &#123;</span><br><span class="line">        mComposer = value.trim();</span><br><span class="line">    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (mProcessGenres &amp;&amp;</span><br><span class="line">            (name.equalsIgnoreCase(<span class="hljs-string">"genre"</span>) || name.startsWith(<span class="hljs-string">"genre;"</span>))) &#123;</span><br><span class="line">        mGenre = getGenreName(value);</span><br><span class="line">    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (name.equalsIgnoreCase(<span class="hljs-string">"year"</span>) || name.startsWith(<span class="hljs-string">"year;"</span>)) &#123;</span><br><span class="line">        mYear = parseSubstring(value, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);</span><br><span class="line">    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (name.equalsIgnoreCase(<span class="hljs-string">"tracknumber"</span>) || name.startsWith(<span class="hljs-string">"tracknumber;"</span>)) &#123;</span><br><span class="line">        <span class="hljs-comment">// track number might be of the form "2/12"</span></span><br><span class="line">        <span class="hljs-comment">// we just read the number before the slash</span></span><br><span class="line">        <span class="hljs-keyword">int</span> num = parseSubstring(value, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);</span><br><span class="line">        mTrack = (mTrack / <span class="hljs-number">1000</span>) * <span class="hljs-number">1000</span> + num;</span><br><span class="line">    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (name.equalsIgnoreCase(<span class="hljs-string">"discnumber"</span>) ||</span><br><span class="line">            name.equals(<span class="hljs-string">"set"</span>) || name.startsWith(<span class="hljs-string">"set;"</span>)) &#123;</span><br><span class="line">        <span class="hljs-comment">// set number might be of the form "1/3"</span></span><br><span class="line">        <span class="hljs-comment">// we just read the number before the slash</span></span><br><span class="line">        <span class="hljs-keyword">int</span> num = parseSubstring(value, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);</span><br><span class="line">        mTrack = (num * <span class="hljs-number">1000</span>) + (mTrack % <span class="hljs-number">1000</span>);</span><br><span class="line">    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (name.equalsIgnoreCase(<span class="hljs-string">"duration"</span>)) &#123;</span><br><span class="line">        mDuration = parseSubstring(value, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);</span><br><span class="line">    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (name.equalsIgnoreCase(<span class="hljs-string">"writer"</span>) || name.startsWith(<span class="hljs-string">"writer;"</span>)) &#123;</span><br><span class="line">        mWriter = value.trim();</span><br><span class="line">    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (name.equalsIgnoreCase(<span class="hljs-string">"compilation"</span>)) &#123;</span><br><span class="line">        mCompilation = parseSubstring(value, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);</span><br><span class="line">    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (name.equalsIgnoreCase(<span class="hljs-string">"isdrm"</span>)) &#123;</span><br><span class="line">        mIsDrm = (parseSubstring(value, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>) == <span class="hljs-number">1</span>);</span><br><span class="line">    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (name.equalsIgnoreCase(<span class="hljs-string">"width"</span>)) &#123;</span><br><span class="line">        mWidth = parseSubstring(value, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);</span><br><span class="line">    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (name.equalsIgnoreCase(<span class="hljs-string">"height"</span>)) &#123;</span><br><span class="line">        mHeight = parseSubstring(value, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);</span><br><span class="line">    &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">        <span class="hljs-comment">//Log.v(TAG, "unknown tag: " + name + " (" + mProcessGenres + ")");</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> 对应的数据已经被传递到了Java侧，剩下的就比较好处理了<br> 本文只是跟了一条大致的代码流程，先到此，后续有可能还要更新一下。</p>
<p> 本文中代码使用的是Android5.1原始代码，欢迎大家留言交流。</p>

        </div>
        
        <div class="level is-size-7 is-uppercase">
            <div class="level-start">
                <div class="level-item">
                    <span class="is-size-6 has-text-grey has-mr-7">#</span>
                    <a class="has-link-grey -link" href="/tags/Framework/">Framework</a>
                </div>
            </div>
        </div>
        
        
        
    </div>
</div>



<div class="card">
    <div class="card-content">
        <h3 class="menu-label has-text-centered">喜欢这篇文章？打赏一下作者吧</h3>
        <div class="buttons is-centered">
            
                
<a class="button is-info donate">
    <span class="icon is-small">
        <i class="fab fa-alipay"></i>
    </span>
    <span>支付宝</span>
    <div class="qrcode"><img src="http://qiniu.fultter.club/alipay.jpg" alt="支付宝"></div>
</a>

                
                
<a class="button is-success donate">
    <span class="icon is-small">
        <i class="fab fa-weixin"></i>
    </span>
    <span>微信</span>
    <div class="qrcode"><img src="http://qiniu.fultter.club/wechat.png" alt="微信"></div>
</a>

                
        </div>
    </div>
</div>



<div class="card card-transparent">
    <div class="level post-navigation is-flex-wrap is-mobile">
        
        <div class="level-start">
            <a class="level level-item has-link-grey  article-nav-prev" href="/2016/04/20/《Android 应用 之路》简易贪吃蛇/">
                <i class="level-item fas fa-chevron-left"></i>
                <span class="level-item">《Android 应用 之路》简易贪吃蛇</span>
            </a>
        </div>
        
        
        <div class="level-end">
            <a class="level level-item has-link-grey  article-nav-next" href="/2015/09/13/《Android Framework 之路》Android5.1 Camera Framework（四）——框架总结/">
                <span class="level-item">《Android Framework 之路》Android5.1 Camera Framework（四）——框架总结</span>
                <i class="level-item fas fa-chevron-right"></i>
            </a>
        </div>
        
    </div>
</div>



<div class="card">
    <div class="card-content">
        <h3 class="title is-5 has-text-weight-normal">评论</h3>
        
<div id="comment-container"></div>
<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">
<script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script>
<script>
	var gitment = new Gitment({
		id: '2015/10/07/《Android Framework 之路》Android5.1 MediaScanner/',
		owner: 'onlyloveyd',
		repo: 'onlyloveyd.github.io',
		oauth: {
			client_id: '2f74aa28e7577ea363f4',
			client_secret: '5f8765c36434710db05359b75a9b0f1806538d02',
		},
	})
	gitment.render('comment-container')
</script>

    </div>
</div>
</div>
                




<div class="column is-4-tablet is-4-desktop is-3-widescreen  has-order-1 column-left ">
    
        
<div class="card widget">
    <div class="card-content">
        <nav class="level">
            <div class="level-item has-text-centered">
                <div>
                    
                        <img class="image is-128x128 has-mb-6" src="/images/avatar.png" alt="Onlyloveyd">
                    
                    
                    <p class="is-size-4 is-block">
                        Onlyloveyd
                    </p>
                    
                    
                    <p class="is-size-6 is-block">
                        小码过河
                    </p>
                    
                    
                    <p class="is-size-6 is-flex is-flex-center has-text-grey">
                        <i class="fas fa-map-marker-alt has-mr-7"></i>
                        <span>China，GuiYang</span>
                    </p>
                    
                </div>
            </div>
        </nav>
        <nav class="level is-mobile">
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        文章
                    </p>
                    <p class="title has-text-weight-normal">
                        164
                    </p>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        分类
                    </p>
                    <p class="title has-text-weight-normal">
                        14
                    </p>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        标签
                    </p>
                    <p class="title has-text-weight-normal">
                        63
                    </p>
                </div>
            </div>
        </nav>
        <div class="level">
            <a class="level-item button is-link is-rounded" href="https://github.com/onlyloveyd" target="_blank">
                关注我</a>
        </div>
        
        
        <div class="level is-mobile">
            
            <a class="level-item button is-white is-marginless" target="_blank" title="Github" href="https://github.com/onlyloveyd">
                
                <i class="fab fa-github"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" title="CSDN" href="https://blog.csdn.net/poorkick">
                
                <i class="fab fa-dribbble"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" title="RSS" href="/">
                
                <i class="fas fa-rss"></i>
                
            </a>
            
        </div>
        
    </div>
</div>
    
        
    
        

<div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            链接
        </h3>
        <ul class="menu-list">
        
            <li>
                <a class="level is-mobile" href="https://wanandroid.com/" target="_blank">
                    <span class="level-left">
                        <span class="level-item">wanandroid</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">wanandroid.com</span>
                    </span>
                </a>
            </li>
        
            <li>
                <a class="level is-mobile" href="https://leetcode-cn.com/" target="_blank">
                    <span class="level-left">
                        <span class="level-item">LeetCode</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">leetcode-cn.com</span>
                    </span>
                </a>
            </li>
        
            <li>
                <a class="level is-mobile" href="https://angular.cn/" target="_blank">
                    <span class="level-left">
                        <span class="level-item">Angular</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">angular.cn</span>
                    </span>
                </a>
            </li>
        
            <li>
                <a class="level is-mobile" href="http://www.ruanyifeng.com/blog/" target="_blank">
                    <span class="level-left">
                        <span class="level-item">ruanyifeng</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">www.ruanyifeng.com</span>
                    </span>
                </a>
            </li>
        
        </ul>
        </div>
    </div>
</div>


    
        
<div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                分类
            </h3>
            <ul class="menu-list">
            <li>
        <a class="level is-marginless" href="/categories/Android基础/">
            <span class="level-start">
                <span class="level-item">Android基础</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">57</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Android安全/">
            <span class="level-start">
                <span class="level-item">Android安全</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Android应用/">
            <span class="level-start">
                <span class="level-item">Android应用</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">26</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Android开源库/">
            <span class="level-start">
                <span class="level-item">Android开源库</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">29</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Android源码/">
            <span class="level-start">
                <span class="level-item">Android源码</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">11</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Android系统/">
            <span class="level-start">
                <span class="level-item">Android系统</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Android进阶/">
            <span class="level-start">
                <span class="level-item">Android进阶</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">8</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Angular/">
            <span class="level-start">
                <span class="level-item">Angular</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Flutter/">
            <span class="level-start">
                <span class="level-item">Flutter</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Kotlin/">
            <span class="level-start">
                <span class="level-item">Kotlin</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">5</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/LeetCode/">
            <span class="level-start">
                <span class="level-item">LeetCode</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">5</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/ionic/">
            <span class="level-start">
                <span class="level-item">ionic</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/微信小程序/">
            <span class="level-start">
                <span class="level-item">微信小程序</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/运维/">
            <span class="level-start">
                <span class="level-item">运维</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">13</span>
            </span>
        </a></li>
            </ul>
        </div>
    </div>
</div>
    
        
<div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            标签云
        </h3>
        <a href="/tags/Aandroid实战/" style="font-size: 10px;">Aandroid实战</a> <a href="/tags/Android-Studio/" style="font-size: 14.17px;">Android Studio</a> <a href="/tags/Android基础/" style="font-size: 10px;">Android基础</a> <a href="/tags/Android实战/" style="font-size: 19.17px;">Android实战</a> <a href="/tags/Android开源库/" style="font-size: 11.67px;">Android开源库</a> <a href="/tags/Android源码/" style="font-size: 10px;">Android源码</a> <a href="/tags/Angular/" style="font-size: 10px;">Angular</a> <a href="/tags/CentOS/" style="font-size: 11.67px;">CentOS</a> <a href="/tags/Docker/" style="font-size: 12.5px;">Docker</a> <a href="/tags/Drawable/" style="font-size: 10px;">Drawable</a> <a href="/tags/FileProvider/" style="font-size: 10px;">FileProvider</a> <a href="/tags/Flutter/" style="font-size: 10px;">Flutter</a> <a href="/tags/Fragment/" style="font-size: 12.5px;">Fragment</a> <a href="/tags/Framework/" style="font-size: 16.67px;">Framework</a> <a href="/tags/Gank-io/" style="font-size: 11.67px;">Gank.io</a> <a href="/tags/Gitlab/" style="font-size: 10px;">Gitlab</a> <a href="/tags/HAL/" style="font-size: 10px;">HAL</a> <a href="/tags/IDEA插件/" style="font-size: 10px;">IDEA插件</a> <a href="/tags/Kotlin/" style="font-size: 14.17px;">Kotlin</a> <a href="/tags/LeetCode/" style="font-size: 13.33px;">LeetCode</a> <a href="/tags/Linux/" style="font-size: 14.17px;">Linux</a> <a href="/tags/MPAndroidChart/" style="font-size: 13.33px;">MPAndroidChart</a> <a href="/tags/MacOS/" style="font-size: 10px;">MacOS</a> <a href="/tags/Markdown/" style="font-size: 10px;">Markdown</a> <a href="/tags/MultiDex/" style="font-size: 10px;">MultiDex</a> <a href="/tags/Mysql/" style="font-size: 10.83px;">Mysql</a> <a href="/tags/NDK/" style="font-size: 10px;">NDK</a> <a href="/tags/PMDReader/" style="font-size: 10px;">PMDReader</a> <a href="/tags/Picasso/" style="font-size: 10px;">Picasso</a> <a href="/tags/PowerDesign/" style="font-size: 10px;">PowerDesign</a> <a href="/tags/Realm/" style="font-size: 15.83px;">Realm</a> <a href="/tags/RecyclerView/" style="font-size: 10px;">RecyclerView</a> <a href="/tags/Retrofit/" style="font-size: 10px;">Retrofit</a> <a href="/tags/RxJava/" style="font-size: 11.67px;">RxJava</a> <a href="/tags/Smali/" style="font-size: 10.83px;">Smali</a> <a href="/tags/Tomcat/" style="font-size: 10px;">Tomcat</a> <a href="/tags/WanANdroid/" style="font-size: 10px;">WanANdroid</a> <a href="/tags/WebService/" style="font-size: 10px;">WebService</a> <a href="/tags/Xen/" style="font-size: 11.67px;">Xen</a> <a href="/tags/allowBackup/" style="font-size: 10px;">allowBackup</a> <a href="/tags/ionic/" style="font-size: 10px;">ionic</a> <a href="/tags/动画/" style="font-size: 11.67px;">动画</a> <a href="/tags/四大组件/" style="font-size: 10.83px;">四大组件</a> <a href="/tags/多线程/" style="font-size: 10px;">多线程</a> <a href="/tags/局域网/" style="font-size: 10px;">局域网</a> <a href="/tags/工具/" style="font-size: 10px;">工具</a> <a href="/tags/布局控件/" style="font-size: 20px;">布局控件</a> <a href="/tags/应用/" style="font-size: 15px;">应用</a> <a href="/tags/开发问题/" style="font-size: 10px;">开发问题</a> <a href="/tags/开机动画/" style="font-size: 10.83px;">开机动画</a> <a href="/tags/开源/" style="font-size: 10px;">开源</a> <a href="/tags/开源库/" style="font-size: 17.5px;">开源库</a> <a href="/tags/微信公众号/" style="font-size: 10px;">微信公众号</a> <a href="/tags/微信小程序/" style="font-size: 10.83px;">微信小程序</a> <a href="/tags/百度地图/" style="font-size: 12.5px;">百度地图</a> <a href="/tags/系统源码/" style="font-size: 10px;">系统源码</a> <a href="/tags/自定义View/" style="font-size: 15.83px;">自定义View</a> <a href="/tags/虚拟化/" style="font-size: 11.67px;">虚拟化</a> <a href="/tags/设计模式/" style="font-size: 10.83px;">设计模式</a> <a href="/tags/译文/" style="font-size: 18.33px;">译文</a> <a href="/tags/资源/" style="font-size: 10px;">资源</a> <a href="/tags/辅助工具/" style="font-size: 10px;">辅助工具</a> <a href="/tags/配置/" style="font-size: 10px;">配置</a>
    </div>
</div>

    
    
        <div class="column-right-shadow is-hidden-widescreen ">
        
            
<div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            最新文章
        </h3>
        
        <article class="media">
            
            <a href="/2019/07/16/《LeetCode-0005》 最长回文子串-Longest Palindromic Substring/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/gallery/stained.jpeg" alt="《LeetCode-0005》 最长回文子串-Longest Palindromic Substring">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-07-16T13:05:39.000Z">2019-07-16</time></div>
                    <a href="/2019/07/16/《LeetCode-0005》 最长回文子串-Longest Palindromic Substring/" class="has-link-black-ter is-size-6">《LeetCode-0005》 最长回文子串-Longest Palindromic Substring</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/LeetCode/">LeetCode</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2019/07/10/ionic_wanandroid/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/gallery/art-artsy.jpeg" alt="ionic WanAndroid Client">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-07-10T12:09:36.000Z">2019-07-10</time></div>
                    <a href="/2019/07/10/ionic_wanandroid/" class="has-link-black-ter is-size-6">ionic WanAndroid Client</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/ionic/">ionic</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2019/06/10/《LeetCode-0004》 寻找两个有序数组的中位数-Median of Two Sorted Arrays/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/gallery/plant.jpg" alt="《LeetCode-0004》 寻找两个有序数组的中位数-Median of Two Sorted Arrays">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-06-10T12:51:43.000Z">2019-06-10</time></div>
                    <a href="/2019/06/10/《LeetCode-0004》 寻找两个有序数组的中位数-Median of Two Sorted Arrays/" class="has-link-black-ter is-size-6">《LeetCode-0004》 寻找两个有序数组的中位数-Median of Two Sorted Arrays</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/LeetCode/">LeetCode</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2019/06/01/《LeetCode-0003》 无重复字符的最长子串-Longest Substring Without Repeating Characters/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/gallery/deer.jpg" alt="《LeetCode-0003》 无重复字符的最长子串-Longest Substring Without Repeating Characters">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-06-01T00:53:29.000Z">2019-06-01</time></div>
                    <a href="/2019/06/01/《LeetCode-0003》 无重复字符的最长子串-Longest Substring Without Repeating Characters/" class="has-link-black-ter is-size-6">《LeetCode-0003》 无重复字符的最长子串-Longest Substring Without Repeating Characters</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/LeetCode/">LeetCode</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2019/05/26/《LeetCode-0002》 两数相加-Add Two Numbers/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/gallery/desert.jpg" alt="《LeetCode-0002》 两数相加-Add Two Numbers">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-05-26T07:01:33.000Z">2019-05-26</time></div>
                    <a href="/2019/05/26/《LeetCode-0002》 两数相加-Add Two Numbers/" class="has-link-black-ter is-size-6">《LeetCode-0002》 两数相加-Add Two Numbers</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/LeetCode/">LeetCode</a>
                    </p>
                </div>
            </div>
        </article>
        
    </div>
</div>

        
            <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            归档
        </h3>
        <ul class="menu-list">
        
        <li>
            <a class="level is-marginless" href="/archives/2019/07/">
                <span class="level-start">
                    <span class="level-item">七月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/06/">
                <span class="level-start">
                    <span class="level-item">六月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/05/">
                <span class="level-start">
                    <span class="level-item">五月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/04/">
                <span class="level-start">
                    <span class="level-item">四月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/03/">
                <span class="level-start">
                    <span class="level-item">三月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/01/">
                <span class="level-start">
                    <span class="level-item">一月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/12/">
                <span class="level-start">
                    <span class="level-item">十二月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/10/">
                <span class="level-start">
                    <span class="level-item">十月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/08/">
                <span class="level-start">
                    <span class="level-item">八月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/06/">
                <span class="level-start">
                    <span class="level-item">六月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/05/">
                <span class="level-start">
                    <span class="level-item">五月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/04/">
                <span class="level-start">
                    <span class="level-item">四月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/03/">
                <span class="level-start">
                    <span class="level-item">三月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/02/">
                <span class="level-start">
                    <span class="level-item">二月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/01/">
                <span class="level-start">
                    <span class="level-item">一月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/11/">
                <span class="level-start">
                    <span class="level-item">十一月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/10/">
                <span class="level-start">
                    <span class="level-item">十月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/09/">
                <span class="level-start">
                    <span class="level-item">九月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">6</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/08/">
                <span class="level-start">
                    <span class="level-item">八月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/07/">
                <span class="level-start">
                    <span class="level-item">七月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/06/">
                <span class="level-start">
                    <span class="level-item">六月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">8</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/05/">
                <span class="level-start">
                    <span class="level-item">五月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">7</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/04/">
                <span class="level-start">
                    <span class="level-item">四月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/03/">
                <span class="level-start">
                    <span class="level-item">三月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">11</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/02/">
                <span class="level-start">
                    <span class="level-item">二月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/01/">
                <span class="level-start">
                    <span class="level-item">一月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/12/">
                <span class="level-start">
                    <span class="level-item">十二月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/11/">
                <span class="level-start">
                    <span class="level-item">十一月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">8</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/10/">
                <span class="level-start">
                    <span class="level-item">十月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/09/">
                <span class="level-start">
                    <span class="level-item">九月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">11</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/08/">
                <span class="level-start">
                    <span class="level-item">八月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">9</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/07/">
                <span class="level-start">
                    <span class="level-item">七月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">9</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/06/">
                <span class="level-start">
                    <span class="level-item">六月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">7</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/05/">
                <span class="level-start">
                    <span class="level-item">五月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">8</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/04/">
                <span class="level-start">
                    <span class="level-item">四月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2015/10/">
                <span class="level-start">
                    <span class="level-item">十月 2015</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2015/09/">
                <span class="level-start">
                    <span class="level-item">九月 2015</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2015/08/">
                <span class="level-start">
                    <span class="level-item">八月 2015</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2014/04/">
                <span class="level-start">
                    <span class="level-item">四月 2014</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        </ul>
        </div>
    </div>
</div>
        
            <div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                标签
            </h3>
            <div class="field is-grouped is-grouped-multiline">
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Aandroid实战/">
                        <span class="tag">Aandroid实战</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Android-Studio/">
                        <span class="tag">Android Studio</span>
                        <span class="tag is-grey">6</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Android基础/">
                        <span class="tag">Android基础</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Android实战/">
                        <span class="tag">Android实战</span>
                        <span class="tag is-grey">27</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Android开源库/">
                        <span class="tag">Android开源库</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Android源码/">
                        <span class="tag">Android源码</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Angular/">
                        <span class="tag">Angular</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/CentOS/">
                        <span class="tag">CentOS</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Docker/">
                        <span class="tag">Docker</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Drawable/">
                        <span class="tag">Drawable</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/FileProvider/">
                        <span class="tag">FileProvider</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Flutter/">
                        <span class="tag">Flutter</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Fragment/">
                        <span class="tag">Fragment</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Framework/">
                        <span class="tag">Framework</span>
                        <span class="tag is-grey">9</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Gank-io/">
                        <span class="tag">Gank.io</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Gitlab/">
                        <span class="tag">Gitlab</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/HAL/">
                        <span class="tag">HAL</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/IDEA插件/">
                        <span class="tag">IDEA插件</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Kotlin/">
                        <span class="tag">Kotlin</span>
                        <span class="tag is-grey">6</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/LeetCode/">
                        <span class="tag">LeetCode</span>
                        <span class="tag is-grey">5</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Linux/">
                        <span class="tag">Linux</span>
                        <span class="tag is-grey">6</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/MPAndroidChart/">
                        <span class="tag">MPAndroidChart</span>
                        <span class="tag is-grey">5</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/MacOS/">
                        <span class="tag">MacOS</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Markdown/">
                        <span class="tag">Markdown</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/MultiDex/">
                        <span class="tag">MultiDex</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Mysql/">
                        <span class="tag">Mysql</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/NDK/">
                        <span class="tag">NDK</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/PMDReader/">
                        <span class="tag">PMDReader</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Picasso/">
                        <span class="tag">Picasso</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/PowerDesign/">
                        <span class="tag">PowerDesign</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Realm/">
                        <span class="tag">Realm</span>
                        <span class="tag is-grey">8</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/RecyclerView/">
                        <span class="tag">RecyclerView</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Retrofit/">
                        <span class="tag">Retrofit</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/RxJava/">
                        <span class="tag">RxJava</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Smali/">
                        <span class="tag">Smali</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Tomcat/">
                        <span class="tag">Tomcat</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/WanANdroid/">
                        <span class="tag">WanANdroid</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/WebService/">
                        <span class="tag">WebService</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Xen/">
                        <span class="tag">Xen</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/allowBackup/">
                        <span class="tag">allowBackup</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/ionic/">
                        <span class="tag">ionic</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/动画/">
                        <span class="tag">动画</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/四大组件/">
                        <span class="tag">四大组件</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/多线程/">
                        <span class="tag">多线程</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/局域网/">
                        <span class="tag">局域网</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/工具/">
                        <span class="tag">工具</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/布局控件/">
                        <span class="tag">布局控件</span>
                        <span class="tag is-grey">33</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/应用/">
                        <span class="tag">应用</span>
                        <span class="tag is-grey">7</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/开发问题/">
                        <span class="tag">开发问题</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/开机动画/">
                        <span class="tag">开机动画</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/开源/">
                        <span class="tag">开源</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/开源库/">
                        <span class="tag">开源库</span>
                        <span class="tag is-grey">13</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/微信公众号/">
                        <span class="tag">微信公众号</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/微信小程序/">
                        <span class="tag">微信小程序</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/百度地图/">
                        <span class="tag">百度地图</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/系统源码/">
                        <span class="tag">系统源码</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/自定义View/">
                        <span class="tag">自定义View</span>
                        <span class="tag is-grey">8</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/虚拟化/">
                        <span class="tag">虚拟化</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/设计模式/">
                        <span class="tag">设计模式</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/译文/">
                        <span class="tag">译文</span>
                        <span class="tag is-grey">20</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/资源/">
                        <span class="tag">资源</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/辅助工具/">
                        <span class="tag">辅助工具</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/配置/">
                        <span class="tag">配置</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
            </div>
        </div>
    </div>
</div>
        
        </div>
    
</div>

                




<div class="column is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only has-order-3 column-right ">
    
        
<div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            最新文章
        </h3>
        
        <article class="media">
            
            <a href="/2019/07/16/《LeetCode-0005》 最长回文子串-Longest Palindromic Substring/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/gallery/stained.jpeg" alt="《LeetCode-0005》 最长回文子串-Longest Palindromic Substring">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-07-16T13:05:39.000Z">2019-07-16</time></div>
                    <a href="/2019/07/16/《LeetCode-0005》 最长回文子串-Longest Palindromic Substring/" class="has-link-black-ter is-size-6">《LeetCode-0005》 最长回文子串-Longest Palindromic Substring</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/LeetCode/">LeetCode</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2019/07/10/ionic_wanandroid/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/gallery/art-artsy.jpeg" alt="ionic WanAndroid Client">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-07-10T12:09:36.000Z">2019-07-10</time></div>
                    <a href="/2019/07/10/ionic_wanandroid/" class="has-link-black-ter is-size-6">ionic WanAndroid Client</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/ionic/">ionic</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2019/06/10/《LeetCode-0004》 寻找两个有序数组的中位数-Median of Two Sorted Arrays/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/gallery/plant.jpg" alt="《LeetCode-0004》 寻找两个有序数组的中位数-Median of Two Sorted Arrays">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-06-10T12:51:43.000Z">2019-06-10</time></div>
                    <a href="/2019/06/10/《LeetCode-0004》 寻找两个有序数组的中位数-Median of Two Sorted Arrays/" class="has-link-black-ter is-size-6">《LeetCode-0004》 寻找两个有序数组的中位数-Median of Two Sorted Arrays</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/LeetCode/">LeetCode</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2019/06/01/《LeetCode-0003》 无重复字符的最长子串-Longest Substring Without Repeating Characters/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/gallery/deer.jpg" alt="《LeetCode-0003》 无重复字符的最长子串-Longest Substring Without Repeating Characters">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-06-01T00:53:29.000Z">2019-06-01</time></div>
                    <a href="/2019/06/01/《LeetCode-0003》 无重复字符的最长子串-Longest Substring Without Repeating Characters/" class="has-link-black-ter is-size-6">《LeetCode-0003》 无重复字符的最长子串-Longest Substring Without Repeating Characters</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/LeetCode/">LeetCode</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2019/05/26/《LeetCode-0002》 两数相加-Add Two Numbers/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/gallery/desert.jpg" alt="《LeetCode-0002》 两数相加-Add Two Numbers">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-05-26T07:01:33.000Z">2019-05-26</time></div>
                    <a href="/2019/05/26/《LeetCode-0002》 两数相加-Add Two Numbers/" class="has-link-black-ter is-size-6">《LeetCode-0002》 两数相加-Add Two Numbers</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/LeetCode/">LeetCode</a>
                    </p>
                </div>
            </div>
        </article>
        
    </div>
</div>

    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            归档
        </h3>
        <ul class="menu-list">
        
        <li>
            <a class="level is-marginless" href="/archives/2019/07/">
                <span class="level-start">
                    <span class="level-item">七月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/06/">
                <span class="level-start">
                    <span class="level-item">六月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/05/">
                <span class="level-start">
                    <span class="level-item">五月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/04/">
                <span class="level-start">
                    <span class="level-item">四月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/03/">
                <span class="level-start">
                    <span class="level-item">三月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/01/">
                <span class="level-start">
                    <span class="level-item">一月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/12/">
                <span class="level-start">
                    <span class="level-item">十二月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/10/">
                <span class="level-start">
                    <span class="level-item">十月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/08/">
                <span class="level-start">
                    <span class="level-item">八月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/06/">
                <span class="level-start">
                    <span class="level-item">六月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/05/">
                <span class="level-start">
                    <span class="level-item">五月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/04/">
                <span class="level-start">
                    <span class="level-item">四月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/03/">
                <span class="level-start">
                    <span class="level-item">三月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/02/">
                <span class="level-start">
                    <span class="level-item">二月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/01/">
                <span class="level-start">
                    <span class="level-item">一月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/11/">
                <span class="level-start">
                    <span class="level-item">十一月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/10/">
                <span class="level-start">
                    <span class="level-item">十月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/09/">
                <span class="level-start">
                    <span class="level-item">九月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">6</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/08/">
                <span class="level-start">
                    <span class="level-item">八月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/07/">
                <span class="level-start">
                    <span class="level-item">七月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/06/">
                <span class="level-start">
                    <span class="level-item">六月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">8</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/05/">
                <span class="level-start">
                    <span class="level-item">五月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">7</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/04/">
                <span class="level-start">
                    <span class="level-item">四月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/03/">
                <span class="level-start">
                    <span class="level-item">三月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">11</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/02/">
                <span class="level-start">
                    <span class="level-item">二月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/01/">
                <span class="level-start">
                    <span class="level-item">一月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/12/">
                <span class="level-start">
                    <span class="level-item">十二月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/11/">
                <span class="level-start">
                    <span class="level-item">十一月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">8</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/10/">
                <span class="level-start">
                    <span class="level-item">十月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/09/">
                <span class="level-start">
                    <span class="level-item">九月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">11</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/08/">
                <span class="level-start">
                    <span class="level-item">八月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">9</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/07/">
                <span class="level-start">
                    <span class="level-item">七月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">9</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/06/">
                <span class="level-start">
                    <span class="level-item">六月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">7</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/05/">
                <span class="level-start">
                    <span class="level-item">五月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">8</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/04/">
                <span class="level-start">
                    <span class="level-item">四月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2015/10/">
                <span class="level-start">
                    <span class="level-item">十月 2015</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2015/09/">
                <span class="level-start">
                    <span class="level-item">九月 2015</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2015/08/">
                <span class="level-start">
                    <span class="level-item">八月 2015</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2014/04/">
                <span class="level-start">
                    <span class="level-item">四月 2014</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        </ul>
        </div>
    </div>
</div>
    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                标签
            </h3>
            <div class="field is-grouped is-grouped-multiline">
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Aandroid实战/">
                        <span class="tag">Aandroid实战</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Android-Studio/">
                        <span class="tag">Android Studio</span>
                        <span class="tag is-grey">6</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Android基础/">
                        <span class="tag">Android基础</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Android实战/">
                        <span class="tag">Android实战</span>
                        <span class="tag is-grey">27</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Android开源库/">
                        <span class="tag">Android开源库</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Android源码/">
                        <span class="tag">Android源码</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Angular/">
                        <span class="tag">Angular</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/CentOS/">
                        <span class="tag">CentOS</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Docker/">
                        <span class="tag">Docker</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Drawable/">
                        <span class="tag">Drawable</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/FileProvider/">
                        <span class="tag">FileProvider</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Flutter/">
                        <span class="tag">Flutter</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Fragment/">
                        <span class="tag">Fragment</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Framework/">
                        <span class="tag">Framework</span>
                        <span class="tag is-grey">9</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Gank-io/">
                        <span class="tag">Gank.io</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Gitlab/">
                        <span class="tag">Gitlab</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/HAL/">
                        <span class="tag">HAL</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/IDEA插件/">
                        <span class="tag">IDEA插件</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Kotlin/">
                        <span class="tag">Kotlin</span>
                        <span class="tag is-grey">6</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/LeetCode/">
                        <span class="tag">LeetCode</span>
                        <span class="tag is-grey">5</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Linux/">
                        <span class="tag">Linux</span>
                        <span class="tag is-grey">6</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/MPAndroidChart/">
                        <span class="tag">MPAndroidChart</span>
                        <span class="tag is-grey">5</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/MacOS/">
                        <span class="tag">MacOS</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Markdown/">
                        <span class="tag">Markdown</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/MultiDex/">
                        <span class="tag">MultiDex</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Mysql/">
                        <span class="tag">Mysql</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/NDK/">
                        <span class="tag">NDK</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/PMDReader/">
                        <span class="tag">PMDReader</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Picasso/">
                        <span class="tag">Picasso</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/PowerDesign/">
                        <span class="tag">PowerDesign</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Realm/">
                        <span class="tag">Realm</span>
                        <span class="tag is-grey">8</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/RecyclerView/">
                        <span class="tag">RecyclerView</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Retrofit/">
                        <span class="tag">Retrofit</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/RxJava/">
                        <span class="tag">RxJava</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Smali/">
                        <span class="tag">Smali</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Tomcat/">
                        <span class="tag">Tomcat</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/WanANdroid/">
                        <span class="tag">WanANdroid</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/WebService/">
                        <span class="tag">WebService</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Xen/">
                        <span class="tag">Xen</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/allowBackup/">
                        <span class="tag">allowBackup</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/ionic/">
                        <span class="tag">ionic</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/动画/">
                        <span class="tag">动画</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/四大组件/">
                        <span class="tag">四大组件</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/多线程/">
                        <span class="tag">多线程</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/局域网/">
                        <span class="tag">局域网</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/工具/">
                        <span class="tag">工具</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/布局控件/">
                        <span class="tag">布局控件</span>
                        <span class="tag is-grey">33</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/应用/">
                        <span class="tag">应用</span>
                        <span class="tag is-grey">7</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/开发问题/">
                        <span class="tag">开发问题</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/开机动画/">
                        <span class="tag">开机动画</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/开源/">
                        <span class="tag">开源</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/开源库/">
                        <span class="tag">开源库</span>
                        <span class="tag is-grey">13</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/微信公众号/">
                        <span class="tag">微信公众号</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/微信小程序/">
                        <span class="tag">微信小程序</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/百度地图/">
                        <span class="tag">百度地图</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/系统源码/">
                        <span class="tag">系统源码</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/自定义View/">
                        <span class="tag">自定义View</span>
                        <span class="tag is-grey">8</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/虚拟化/">
                        <span class="tag">虚拟化</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/设计模式/">
                        <span class="tag">设计模式</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/译文/">
                        <span class="tag">译文</span>
                        <span class="tag is-grey">20</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/资源/">
                        <span class="tag">资源</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/辅助工具/">
                        <span class="tag">辅助工具</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/配置/">
                        <span class="tag">配置</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
            </div>
        </div>
    </div>
</div>
    
    
</div>

            </div>
        </div>
    </section>
    <footer class="footer">
    <div class="container">
        <div class="level">
            <div class="level-start has-text-centered-mobile">
                <a class="footer-logo is-block has-mb-6" href="/">
                
                    <img src="/images/logo.svg" alt="《Android Framework 之路》Android5.1 MediaScanner" height="28">
                
                </a>
                <p class="is-size-7">
                &copy; 2019 yidong&nbsp;
                Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> & <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank">Icarus</a>
                
                </p>
            </div>
            <div class="level-end">
            
                <div class="field has-addons is-flex-center-mobile has-mt-5-mobile is-flex-wrap is-flex-middle">
                
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Creative Commons" href="https://creativecommons.org/">
                        
                        <i class="fab fa-creative-commons"></i>
                        
                    </a>
                </p>
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/">
                        
                        <i class="fab fa-creative-commons-by"></i>
                        
                    </a>
                </p>
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus">
                        
                        <i class="fab fa-github"></i>
                        
                    </a>
                </p>
                
                </div>
            
            </div>
        </div>
    </div>
</footer>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script>
<script>moment.locale("zh-CN");</script>


    
    
    
    <script src="/js/animation.js"></script>
    

    
    
    
    <script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script>
    <script src="/js/gallery.js" defer></script>
    

    
    

<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update
            my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        });
    });
</script>


    
    
<script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    MathJax.Hub.Config({
        'HTML-CSS': {
            matchFontHeight: false
        },
        SVG: {
            matchFontHeight: false
        },
        CommonHTML: {
            matchFontHeight: false
        },
        tex2jax: {
            inlineMath: [
                ['$','$'],
                ['\\(','\\)']
            ]
        }
    });
});
</script>

    
    

<a id="back-to-top" title="回到顶端" href="javascript:;">
    <i class="fas fa-chevron-up"></i>
</a>
<script src="/js/back-to-top.js" defer></script>


    
    

    
    
    
    

    
    
    
    
    
    <script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script>
    <script src="/js/clipboard.js" defer></script>
    

    
    
    


<script src="/js/main.js" defer></script>

    
    <div class="searchbox ins-search">
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="想要查找什么...">
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: '文章',
                PAGES: '页面',
                CATEGORIES: '分类',
                TAGS: '标签',
                UNTITLED: '(无标题)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script src="/js/insight.js" defer></script>
<link rel="stylesheet" href="/css/search.css">
<link rel="stylesheet" href="/css/insight.css">
    
</body>
</html>